<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Екатерина Новак - Писательница детективов и фэнтези | Официальный сайт</title>

<!-- SEO Meta Tags -->
<meta name="description" content="Екатерина Новак - писательница детективов и фэнтези. Серии 'Дилетантки' и 'Долина Инферин'. Читайте книги, слушайте аудиокниги, проходите квизы.">
<meta name="keywords" content="Екатерина Новак, писательница, детективы, фэнтези, Дилетантки, Долина Инферин, книги, аудиокниги">
<meta name="author" content="Екатерина Новак">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://novakamskaya.ru/">
<meta property="og:title" content="Екатерина Новак - Писательница детективов и фэнтези">
<meta property="og:description" content="Официальный сайт писательницы Екатерины Новак. Детективы, фэнтези и романы. Серии 'Дилетантки' и 'Долина Инферин'.">
<meta property="og:image" content="https://novakamskaya.ru/images/og-image.jpg">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://novakamskaya.ru/">
<meta property="twitter:title" content="Екатерина Новак - Писательница">
<meta property="twitter:description" content="Детективы, фэнтези и романы от популярной писательницы">
<meta property="twitter:image" content="https://novakamskaya.ru/images/og-image.jpg">

<!-- Security -->
<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https:; img-src 'self' data: https:; media-src 'self' https:;">

<!-- Favicon -->
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@600;700&family=Marck+Script&display=swap" rel="stylesheet">

<!-- JSON-LD Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "Екатерина Новак",
  "jobTitle": "Писательница",
  "description": "Писательница детективов и фэнтези, автор серий 'Дилетантки' и 'Долина Инферин'",
  "url": "https://novakamskaya.ru",
  "image": "https://novakamskaya.ru/images/author-photo.jpg",
  "sameAs": [
    "https://vk.com/novakamskaya",
    "https://t.me/novakamskaya"
  ],
  "worksFor": {
    "@type": "Organization",
    "name": "Независимый автор"
  }
}
</script>

<style>
/* ===== DESIGN TOKENS ===== */
:root {
  /* Colors - Light theme */
  --bg-0: #FFFFFF;
  --bg-1: #FFF7FA;
  --rose: #ED6AA7;
  --rose-grad: linear-gradient(95deg, #ED6AA7 0%, #F397C7 100%);
  --gold: #D8A600;
  --gold-soft: rgba(216, 166, 0, 0.4);
  --cocoa: #56575C;
  --blush: #FFEFF5;
  
  /* Shadows - Light */
  --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
  --shadow-md: 0 8px 20px rgba(0,0,0,0.06);
  --shadow-lg: 0 18px 42px rgba(0,0,0,0.07);
  --shadow-xl: 0 24px 60px rgba(0,0,0,0.12);
  
  /* Typography scales */
  --font-display: 'Playfair Display', serif;
  --font-body: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  --font-script: 'Marck Script', cursive;
  
  /* Font sizes */
  --fs-h1: clamp(2rem, 5vw, 3.5rem);
  --fs-h2: clamp(1.75rem, 4vw, 2.5rem);
  --fs-h3: clamp(1.5rem, 3vw, 2rem);
  --fs-h4: clamp(1.25rem, 2.5vw, 1.5rem);
  --fs-body: 16px;
  --fs-small: 14px;
  --fs-tiny: 12px;
  
  /* Spacing */
  --space-xs: 4px;
  --space-sm: 8px;
  --space-md: 16px;
  --space-lg: 24px;
  --space-xl: 32px;
  --space-2xl: 48px;
  --space-3xl: 64px;
  
  /* Border radius */
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 24px;
  --radius-2xl: 32px;
  --radius-full: 9999px;
  
  /* Transitions */
  --transition-base: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-fast: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-slow: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  
  /* Z-index layers */
  --z-base: 1;
  --z-dropdown: 10;
  --z-sticky: 100;
  --z-overlay: 1000;
  --z-modal: 1100;
  --z-tooltip: 1200;
}

/* Dark theme */
:root.dark {
  --bg-0: #1B1B24;
  --bg-1: #262837;
  --rose: #ED6AA7;
  --rose-grad: linear-gradient(95deg, #ED6AA7 0%, #F397C7 100%);
  --gold: #E5C36D;
  --gold-soft: rgba(229, 195, 109, 0.33);
  --cocoa: #E0E0E0;
  --blush: #2A2A38;
  
  --shadow-sm: 0 4px 12px rgba(0,0,0,0.20);
  --shadow-md: 0 12px 30px rgba(0,0,0,0.25);
  --shadow-lg: 0 22px 60px rgba(0,0,0,0.28);
  --shadow-xl: 0 32px 80px rgba(0,0,0,0.40);
}

/* Respect user preferences for reduced motion */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* ===== BASE STYLES ===== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  font-family: var(--font-body);
  font-size: var(--fs-body);
  line-height: 1.6;
  color: var(--cocoa);
  background: var(--bg-0);
  min-height: 100vh;
  transition: var(--transition-base);
  overflow-x: hidden;
  position: relative;
}

/* ===== TYPOGRAPHY ===== */
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-display);
  font-weight: 700;
  line-height: 1.2;
  letter-spacing: -0.02em;
}

h1 { font-size: var(--fs-h1); }
h2 { font-size: var(--fs-h2); }
h3 { font-size: var(--fs-h3); }
h4 { font-size: var(--fs-h4); }

/* Focus styles for accessibility */
*:focus {
  outline: 2px solid var(--rose);
  outline-offset: 2px;
}

/* Skip link for accessibility */
.skip-link {
  position: absolute;
  top: -40px;
  left: 6px;
  background: var(--rose);
  color: white;
  padding: 8px;
  text-decoration: none;
  border-radius: 4px;
  z-index: 999999;
  transition: top 0.2s;
}

.skip-link:focus {
  top: 6px;
}

/* Gradient text effect */
.gradient-text {
  background: linear-gradient(135deg, var(--rose) 0%, #B983DB 25%, #FF1493 50%, #FFB8D1 75%, #B983DB 100%);
  background-size: 300% auto;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  color: transparent;
  animation: gradient-shift 4s ease infinite;
}

.font-quote {
  font-family: var(--font-script);
  font-size: clamp(1.75rem, 3.2vw, 3.25rem);
  line-height: 1.2;
  color: var(--cocoa);
}

.font-quote.gold {
  background: linear-gradient(90deg, var(--gold) 0%, var(--gold-soft) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  color: transparent;
  background-size: 200% auto;
  animation: gold-shine 3s linear infinite;
}

/* ===== KEYFRAME ANIMATIONS ===== */
@keyframes gold-shine {
  0% { background-position: 0% 50%; }
  100% { background-position: 200% 50%; }
}

@keyframes gradient-shift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(100px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes slideInLeft {
  from {
    opacity: 0;
    transform: translateX(-100px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

@keyframes heartbeat {
  0%, 100% { transform: scale(1); }
  14%, 28% { transform: scale(1.15); }
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-20px); }
}

/* ===== UTILITY CLASSES ===== */
.container {
  width: 100%;
  max-width: 1280px;
  margin: 0 auto;
  padding: 0 var(--space-lg);
}

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0,0,0,0);
  white-space: nowrap;
  border-width: 0;
}

/* ===== COMPONENTS ===== */

/* Button Component */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-sm);
  padding: var(--space-md) var(--space-xl);
  font-size: var(--fs-body);
  font-weight: 600;
  font-family: var(--font-body);
  text-decoration: none;
  border: none;
  border-radius: var(--radius-md);
  background: var(--rose-grad);
  color: white;
  cursor: pointer;
  transition: var(--transition-base);
  transform: translateY(0);
  box-shadow: var(--shadow-sm);
  position: relative;
  overflow: hidden;
  z-index: 1;
  min-height: 44px; /* Better touch target */
}

.btn:hover:not(:disabled) {
  transform: translateY(-4px);
  box-shadow: var(--shadow-lg);
}

.btn:active {
  transform: scale(0.97);
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.btn-secondary {
  background: #6B7280;
}

.btn-outline {
  background: transparent;
  border: 2px solid var(--rose);
  color: var(--rose);
}

.btn-outline:hover {
  background: var(--rose);
  color: white;
}

.btn-small {
  padding: var(--space-sm) var(--space-md);
  font-size: var(--fs-small);
  min-height: 36px;
}

.btn-large {
  padding: var(--space-lg) var(--space-2xl);
  font-size: 18px;
  min-height: 52px;
}

/* Tag Pill Component */
.tag-pill {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 12px 24px;
  font-size: 15px;
  font-weight: 600;
  background: linear-gradient(135deg, rgba(237, 106, 167, 0.1) 0%, rgba(243, 151, 199, 0.1) 100%);
  color: var(--rose);
  border: 2px solid transparent;
  border-radius: var(--radius-md);
  transition: var(--transition-fast);
  cursor: pointer;
  text-decoration: none;
  white-space: nowrap;
  min-height: 44px;
}

.tag-pill:hover {
  background: linear-gradient(135deg, rgba(237, 106, 167, 0.15) 0%, rgba(243, 151, 199, 0.15) 100%);
  transform: translateY(-2px);
  box-shadow: var(--shadow-sm);
}

.tag-pill.active {
  background: var(--rose-grad);
  color: white;
  animation: pulse 0.3s ease;
}

/* Meta Pill */
.meta-pill {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 12px;
  font-size: var(--fs-tiny);
  color: var(--cocoa);
  background: var(--blush);
  border-radius: 16px;
  opacity: 0.8;
}

/* Card Component */
.card {
  background: var(--bg-1);
  border-radius: var(--radius-xl);
  padding: var(--space-xl);
  box-shadow: var(--shadow-md);
  transition: var(--transition-base);
  position: relative;
  overflow: hidden;
}

.card:hover {
  transform: translateY(-6px);
  box-shadow: var(--shadow-lg);
}

/* Loading states */
.skeleton {
  background: linear-gradient(90deg, var(--blush) 25%, rgba(255,255,255,0.5) 50%, var(--blush) 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
}

@keyframes loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

.skeleton-card {
  padding: var(--space-xl);
  border-radius: var(--radius-xl);
}

.skeleton-image {
  width: 100%;
  height: 200px;
  border-radius: var(--radius-md);
  margin-bottom: var(--space-md);
}

.skeleton-text {
  height: 20px;
  border-radius: 4px;
  margin-bottom: var(--space-sm);
}

/* Error states */
.error-boundary {
  text-align: center;
  padding: var(--space-3xl);
  color: var(--cocoa);
}

.error-message {
  background: #FEF2F2;
  border: 1px solid #FECACA;
  color: #DC2626;
  padding: var(--space-md);
  border-radius: var(--radius-md);
  margin: var(--space-md) 0;
}

/* Navigation Component */
.navbar {
  position: sticky;
  top: 0;
  z-index: var(--z-sticky);
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-bottom: 1px solid transparent;
  transition: var(--transition-base);
}

.dark .navbar {
  background: rgba(27, 27, 36, 0.9);
}

.navbar.scrolled {
  border-bottom-color: var(--gold);
  box-shadow: var(--shadow-sm);
}

.navbar-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-md) var(--space-lg);
}

/* Logo and brand */
.nav-brand {
  display: flex;
  align-items: center;
  gap: var(--space-md);
  text-decoration: none;
  color: var(--cocoa);
  transition: var(--transition-fast);
  flex-shrink: 0;
}

.nav-brand:hover {
  transform: scale(1.02);
}

.logo-circle {
  width: 44px;
  height: 44px;
  background: var(--rose-grad);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 20px;
  transition: var(--transition-base);
  position: relative;
  overflow: hidden;
}

.nav-brand:hover .logo-circle {
  animation: heartbeat 1.2s ease-in-out infinite;
}

.brand-text h1 {
  font-family: var(--font-script);
  font-size: 24px;
  font-weight: 400;
  margin: 0;
}

.brand-text p {
  font-size: 13px;
  color: var(--rose);
  margin: 0;
}

/* Nav menu */
.nav-menu {
  display: flex;
  gap: 2px;
  align-items: center;
  justify-content: center;
  flex: 1;
  padding: 0 10px;
}

.nav-link {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 6px 10px;
  color: var(--cocoa);
  text-decoration: none;
  font-size: 14px;
  font-weight: 500;
  border-radius: 10px;
  transition: var(--transition-fast);
  position: relative;
  white-space: nowrap;
  min-height: 44px;
}

.nav-link::after {
  content: '';
  position: absolute;
  bottom: 6px;
  left: 10px;
  right: 10px;
  height: 2px;
  background: var(--rose);
  transform: scaleX(0);
  transform-origin: center;
  transition: transform 0.3s ease;
}

.nav-link:hover {
  color: var(--rose);
}

.nav-link:hover::after {
  transform: scaleX(1);
}

.nav-link.active {
  color: var(--rose);
}

.nav-link.active::after {
  transform: scaleX(1);
}

/* Nav controls */
.nav-controls {
  display: flex;
  align-items: center;
  gap: var(--space-md);
  flex-shrink: 0;
}

/* Theme Toggle */
.theme-toggle {
  width: 56px;
  height: 28px;
  background: #E5E7EB;
  border-radius: 14px;
  position: relative;
  cursor: pointer;
  transition: var(--transition-base);
  border: none;
  padding: 0;
}

.dark .theme-toggle {
  background: #374151;
}

.theme-toggle-slider {
  position: absolute;
  top: 3px;
  left: 3px;
  width: 22px;
  height: 22px;
  background: white;
  border-radius: 50%;
  transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

.dark .theme-toggle-slider {
  transform: translateX(28px);
}

/* Mobile Menu */
.menu-toggle {
  display: none;
  width: 40px;
  height: 40px;
  background: transparent;
  border: 2px solid var(--rose);
  border-radius: 10px;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: var(--rose);
  font-size: 20px;
  transition: var(--transition-fast);
}

.menu-toggle:hover {
  background: var(--rose);
  color: white;
}

.nav-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.4);
  opacity: 0;
  visibility: hidden;
  transition: var(--transition-base);
  z-index: var(--z-overlay);
}

.nav-overlay.active {
  opacity: 1;
  visibility: visible;
}

.nav-mobile {
  position: fixed;
  top: 0;
  right: -100%;
  width: 80%;
  max-width: 400px;
  height: 100vh;
  background: var(--bg-1);
  transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  z-index: calc(var(--z-overlay) + 1);
  overflow-y: auto;
  box-shadow: -4px 0 20px rgba(0,0,0,0.1);
}

.nav-mobile.active {
  right: 0;
}

.nav-mobile-header {
  padding: var(--space-lg);
  border-bottom: 1px solid var(--gold);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.nav-close {
  background: none;
  border: none;
  font-size: 28px;
  cursor: pointer;
  color: var(--cocoa);
  padding: 10px;
  transition: var(--transition-fast);
  min-width: 44px;
  min-height: 44px;
}

.nav-close:hover {
  color: var(--rose);
  transform: rotate(90deg);
}

.nav-mobile-links {
  padding: var(--space-lg);
}

.nav-mobile-link {
  display: block;
  padding: var(--space-md) 10px;
  color: var(--cocoa);
  text-decoration: none;
  font-size: 18px;
  font-weight: 500;
  transition: var(--transition-base);
  border-bottom: 1px solid var(--blush);
  position: relative;
  overflow: hidden;
  min-height: 44px;
}

.nav-mobile-link:hover {
  color: var(--rose);
  padding-left: var(--space-lg);
}

/* Reading Progress Bar */
.reading-progress {
  position: fixed;
  top: 0;
  left: 0;
  height: 3px;
  background: var(--rose-grad);
  width: 0%;
  z-index: calc(var(--z-sticky) + 1);
  transition: width 0.2s ease;
}

/* Hero Section */
.hero {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
  padding: 80px var(--space-lg);
}

.hero-bg {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, var(--blush) 0%, var(--bg-0) 100%);
  opacity: 0.5;
  z-index: -1;
}

.hero-content {
  text-align: center;
  max-width: 800px;
  margin: 0 auto;
}

.hero-title {
  margin-bottom: var(--space-lg);
  animation: fadeInUp 0.6s ease 0.2s both;
}

.hero-subtitle {
  font-size: 20px;
  color: var(--cocoa);
  opacity: 0.8;
  margin-bottom: var(--space-xl);
  animation: fadeInUp 0.6s ease 0.4s both;
}

.hero-quote {
  margin-bottom: var(--space-2xl);
  animation: fadeInUp 0.6s ease 0.6s both;
}

.hero-cta {
  display: flex;
  gap: var(--space-md);
  justify-content: center;
  flex-wrap: wrap;
  animation: fadeInUp 0.6s ease 0.8s both;
}

/* Section */
.section {
  padding: var(--space-3xl) 0;
}

.section-header {
  text-align: center;
  margin-bottom: var(--space-3xl);
}

.section-title {
  margin-bottom: var(--space-md);
}

.section-subtitle {
  font-size: 18px;
  color: var(--cocoa);
  opacity: 0.8;
  max-width: 600px;
  margin: 0 auto;
}

/* Grid System */
.grid {
  display: grid;
  gap: var(--space-lg);
}

.grid-cols-1 { grid-template-columns: 1fr; }
.grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
.grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
.grid-cols-4 { grid-template-columns: repeat(4, 1fr); }

/* Book Card Component */
.book-card {
  background: var(--bg-1);
  border-radius: var(--radius-lg);
  overflow: hidden;
  box-shadow: var(--shadow-sm);
  transition: var(--transition-base);
  border: 1px solid transparent;
  cursor: pointer;
  animation: fadeInUp 0.6s ease both;
  position: relative;
}

.book-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-md);
  border-color: var(--gold);
}

.book-cover {
  width: 100%;
  aspect-ratio: 3/4;
  background: linear-gradient(135deg, #FFB8D1, #FFCFE5);
  position: relative;
  overflow: hidden;
}

.book-cover img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: var(--transition-slow);
}

.book-card:hover .book-cover img {
  transform: scale(1.05);
}

.book-info {
  padding: var(--space-md);
}

.book-title {
  font-family: var(--font-display);
  font-size: 18px;
  font-weight: 700;
  margin-bottom: var(--space-xs);
  color: var(--cocoa);
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.book-series {
  font-size: 13px;
  color: var(--rose);
  margin-bottom: var(--space-sm);
}

.book-description {
  font-size: 13px;
  color: var(--cocoa);
  opacity: 0.7;
  line-height: 1.4;
  margin-bottom: var(--space-sm);
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  position: relative;
  max-height: 2.8em;
  transition: max-height 0.3s ease;
}

.book-description.expanded {
  -webkit-line-clamp: unset;
  max-height: 200px;
}

.expand-btn {
  font-size: 12px;
  color: var(--rose);
  cursor: pointer;
  background: none;
  border: none;
  padding: 0;
  margin-bottom: var(--space-sm);
  transition: var(--transition-fast);
  min-height: 24px;
}

.expand-btn:hover {
  text-decoration: underline;
}

.book-meta {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-sm);
  flex-wrap: wrap;
}

.book-rating {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  color: #FFA500;
  font-size: 13px;
}

.book-actions {
  display: flex;
  gap: var(--space-xs);
  margin-top: var(--space-md);
  flex-wrap: wrap;
}

.store-link {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 6px 12px;
  background: var(--rose-grad);
  color: white;
  text-decoration: none;
  border-radius: var(--radius-sm);
  font-size: 12px;
  font-weight: 600;
  transition: var(--transition-fast);
  box-shadow: var(--shadow-sm);
  white-space: nowrap;
  min-height: 32px;
}

.store-link:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
  filter: brightness(1.1);
}

.store-link:active {
  transform: scale(0.98);
}

/* Footer */
.footer {
  background: linear-gradient(135deg, 
    #FFFFFF 0%, 
    #FFF8FB 20%, 
    #FFEFF5 40%, 
    #FFE8F1 60%, 
    #FFEEF4 80%, 
    #FFFFFF 100%
  );
  color: var(--cocoa);
  padding: var(--space-3xl) 0 var(--space-xl);
  margin-top: 100px;
  position: relative;
  box-shadow: 0 -8px 32px rgba(237, 106, 167, 0.08);
  border-top: 1px solid rgba(237, 106, 167, 0.1);
  overflow: hidden;
  animation: pearl-shimmer 8s ease-in-out infinite;
}

@keyframes pearl-shimmer {
  0% {
    background: linear-gradient(135deg, 
      #FFFFFF 0%, 
      #FFF8FB 20%, 
      #FFEFF5 40%, 
      #FFE8F1 60%, 
      #FFEEF4 80%, 
      #FFFFFF 100%
    );
    box-shadow: 0 -8px 32px rgba(237, 106, 167, 0.08);
  }
  25% {
    background: linear-gradient(135deg, 
      #FFFBFF 0%, 
      #FFF5F9 20%, 
      #FFEBF1 40%, 
      #FFE4ED 60%, 
      #FFEAF0 80%, 
      #FFFBFF 100%
    );
    box-shadow: 0 -8px 32px rgba(237, 106, 167, 0.06), 
                0 0 20px rgba(255, 255, 255, 0.3);
  }
  50% {
    background: linear-gradient(135deg, 
      #FFF9FD 0%, 
      #FFF2F7 20%, 
      #FFE8EF 40%, 
      #FFE1EA 60%, 
      #FFE7ED 80%, 
      #FFF9FD 100%
    );
    box-shadow: 0 -8px 32px rgba(216, 166, 0, 0.04), 
                0 0 25px rgba(255, 248, 220, 0.4);
  }
  75% {
    background: linear-gradient(135deg, 
      #FFFAFF 0%, 
      #FFF6FA 20%, 
      #FFECF3 40%, 
      #FFE5EE 60%, 
      #FFEBF1 80%, 
      #FFFAFF 100%
    );
    box-shadow: 0 -8px 32px rgba(237, 106, 167, 0.06), 
                0 0 20px rgba(255, 240, 245, 0.5);
  }
  100% {
    background: linear-gradient(135deg, 
      #FFFFFF 0%, 
      #FFF8FB 20%, 
      #FFEFF5 40%, 
      #FFE8F1 60%, 
      #FFEEF4 80%, 
      #FFFFFF 100%
    );
    box-shadow: 0 -8px 32px rgba(237, 106, 167, 0.08);
  }
}

.footer::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, var(--rose) 0%, var(--gold) 50%, var(--rose) 100%);
  background-size: 200% auto;
  animation: gradient-shift 6s ease infinite;
}

.dark .footer {
  background: #0F0F1A;
  border-top: 1px solid rgba(255,255,255,0.1);
  color: white;
  box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.4);
  animation: none;
}

.dark .footer::before {
  display: none;
}

.footer-content {
  display: grid;
  grid-template-columns: 1.5fr 1fr 1fr 1fr;
  gap: var(--space-2xl);
  margin-bottom: var(--space-2xl);
}

.footer-section h3 {
  font-family: var(--font-display);
  font-size: 18px;
  font-weight: 700;
  margin-bottom: var(--space-lg);
  color: var(--rose);
}

.dark .footer-section h3 {
  color: var(--rose);
}

.footer-link {
  display: block;
  color: var(--cocoa);
  text-decoration: none;
  font-size: 15px;
  padding: var(--space-sm) 0;
  transition: var(--transition-fast);
  opacity: 0.8;
  min-height: 32px;
}

.footer-link:hover {
  color: var(--rose);
  transform: translateX(5px);
  opacity: 1;
}

.dark .footer-link {
  color: #B0B0B0;
}

.dark .footer-link:hover {
  color: white;
}

.footer-social {
  display: flex;
  gap: var(--space-md);
  margin-top: var(--space-lg);
}

.social-link {
  width: 40px;
  height: 40px;
  background: rgba(237, 106, 167, 0.1);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition-fast);
  text-decoration: none;
  color: var(--rose);
  border: 1px solid rgba(237, 106, 167, 0.2);
}

.social-link:hover {
  background: var(--rose);
  color: white;
  transform: translateY(-4px);
  box-shadow: 0 8px 20px rgba(237, 106, 167, 0.3);
}

/* Улучшенные hover эффекты для социальных кнопок в разделе "О себе" */
#about-content .social-link:hover {
  transform: translateY(-4px) !important;
  box-shadow: var(--shadow-md) !important;
}

.dark .social-link {
  background: rgba(255,255,255,0.1);
  color: white;
  border-color: rgba(255,255,255,0.2);
}

.dark .social-link:hover {
  background: var(--rose);
  color: white;
}

.footer-bottom {
  text-align: center;
  padding-top: var(--space-xl);
  border-top: 1px solid rgba(237, 106, 167, 0.15);
  color: var(--cocoa);
  font-size: var(--fs-small);
  opacity: 0.7;
}

.dark .footer-bottom {
  border-top: 1px solid rgba(255,255,255,0.1);
  color: #808080;
}

/* Page */
.page {
  display: none;
  min-height: calc(100vh - 80px);
  padding: var(--space-2xl) 0 var(--space-3xl);
  animation: pageIn 0.5s ease;
}

.page.active {
  display: block;
}

@keyframes pageIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Scroll animations trigger */
[data-animate] {
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.6s ease;
}

[data-animate].animated {
  opacity: 1;
  transform: translateY(0);
}

/* Media Queries */
@media (max-width: 1200px) {
  .nav-link {
    padding: 6px 8px;
    font-size: 13px;
  }
}

@media (max-width: 1024px) {
  .grid-cols-4 { grid-template-columns: repeat(3, 1fr); }
  .grid-cols-2 { grid-template-columns: 1fr; }
  .nav-link span { display: none; }
  .nav-link { padding: var(--space-sm); }
  .nav-link svg { width: 22px; height: 22px; }
  
  .footer-content {
    grid-template-columns: 1fr 1fr;
    gap: var(--space-xl);
  }
  
  .footer-section:first-child {
    grid-column: 1 / -1;
  }
}

@media (max-width: 768px) {
  :root {
    --fs-h1: clamp(1.75rem, 4vw, 2.5rem);
    --fs-h2: clamp(1.5rem, 3vw, 2rem);
    --fs-h3: clamp(1.25rem, 2.5vw, 1.75rem);
  }
  
  .nav-menu { display: none; }
  .menu-toggle { display: flex; }
  
  .grid-cols-3,
  .grid-cols-4 { grid-template-columns: repeat(2, 1fr); }
  
  .hero { min-height: 80vh; padding: 60px var(--space-lg); }
  .section { padding: var(--space-3xl) 0; }
  
  .footer-content { 
    grid-template-columns: 1fr;
    gap: var(--space-xl);
  }
  
  .footer-section:first-child {
    margin-bottom: var(--space-xl);
  }
  
  /* Адаптивность страницы "О себе" */
  #about-content > div:first-child {
    flex-direction: column !important;
    text-align: center !important;
    gap: 40px !important;
  }
  
  #about-content > div:first-child > div:first-child {
    margin: 0 auto !important;
  }
  
  /* Убираем декоративные элементы на мобильных */
  #about-content > div:first-child > div:first-child > div:nth-child(2),
  #about-content > div:first-child > div:first-child > div:nth-child(3) {
    display: none !important;
  }
}

@media (max-width: 480px) {
  .grid-cols-2,
  .grid-cols-3,
  .grid-cols-4 { grid-template-columns: 1fr; }
  
  .hero-cta { 
    flex-direction: column; 
    width: 100%; 
  }
  .btn { width: 100%; }
  
  .book-card { 
    margin: 0 auto; 
    max-width: 320px; 
  }
  
  /* Мобильный timeline */
  .timeline::before { 
    left: 20px; 
  }
  .timeline-item { 
    padding-left: 50px !important; 
    padding-right: 0 !important;
    text-align: left !important;
  }
  .timeline-dot { 
    left: 20px; 
  }
  
  /* Адаптивность для "О себе" на очень маленьких экранах */
  #about-content .card {
    padding: 25px 20px !important;
    border-radius: 20px !important;
  }
  
  #about-content > div:first-child > div:last-child {
    max-width: 100% !important;
  }
  
  /* Адаптивность для карточек "О себе" */
  #about-content div[style*="grid-template-columns: repeat(3, 1fr)"] {
    grid-template-columns: 1fr !important;
    gap: 20px !important;
  }
  
  /* Адаптивность для секции "Давайте дружить!" на мобильных */
  #about-content div[style*="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr))"] {
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 16px !important;
  }
  
  /* Уменьшаем размер социальных кнопок на мобильных */
  #about-content .social-link[style*="flex-direction: column"] {
    padding: 20px 16px !important;
    font-size: 14px !important;
    min-height: 100px !important;
  }
  
  #about-content .social-link svg {
    width: 28px !important;
    height: 28px !important;
  }
  
  /* Уменьшаем отступы секции "Давайте дружить!" на мобильных */
  #about-content div[style*="margin-top: 80px"] {
    margin-top: 60px !important;
    padding: 40px 20px !important;
  }
}

/* Additional Components for better UX */

/* Character Card Component */
.character-card {
  background: var(--bg-1);
  border-radius: var(--radius-xl);
  padding: var(--space-xl);
  text-align: center;
  box-shadow: var(--shadow-md);
  transition: var(--transition-base);
  animation: fadeInUp 0.6s ease both;
}

.character-card:hover {
  transform: translateY(-5px) rotateY(5deg);
  box-shadow: var(--shadow-lg);
}

.character-avatar {
  width: 120px;
  height: 120px;
  background: linear-gradient(135deg, #F5E6D3, #FAF0E6);
  border-radius: 50%;
  margin: 0 auto var(--space-lg);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 50px;
  position: relative;
  overflow: hidden;
}

.character-name {
  font-family: var(--font-display);
  font-size: 24px;
  font-weight: 700;
  margin-bottom: var(--space-sm);
}

.character-role {
  font-size: var(--fs-body);
  color: var(--rose);
  margin-bottom: var(--space-md);
}

.character-description {
  font-size: 15px;
  color: var(--cocoa);
  line-height: 1.6;
  margin-bottom: var(--space-lg);
  opacity: 0.8;
}

.character-skills {
  display: flex;
  gap: var(--space-sm);
  flex-wrap: wrap;
  justify-content: center;
}

/* Audio Player Component */
.audio-player {
  background: var(--bg-1);
  border-radius: 20px;
  padding: var(--space-xl);
  box-shadow: var(--shadow-md);
  display: flex;
  align-items: center;
  gap: var(--space-lg);
  transition: var(--transition-base);
}

.audio-player:hover {
  box-shadow: var(--shadow-lg);
}

.audio-cover {
  width: 100px;
  height: 100px;
  background: linear-gradient(135deg, #D4B5F5, #E2CBFA);
  border-radius: var(--radius-lg);
  position: relative;
  overflow: hidden;
  flex-shrink: 0;
}

.audio-info {
  flex: 1;
}

.audio-title {
  font-family: var(--font-display);
  font-size: 20px;
  font-weight: 700;
  margin-bottom: var(--space-xs);
}

.audio-author {
  font-size: var(--fs-small);
  color: var(--cocoa);
  opacity: 0.7;
  margin-bottom: var(--space-sm);
}

.audio-progress {
  width: 100%;
  height: 6px;
  background: var(--blush);
  border-radius: 3px;
  overflow: hidden;
  margin-bottom: var(--space-sm);
}

.audio-progress-bar {
  height: 100%;
  background: var(--rose);
  width: 35%;
  transition: width 0.3s ease;
}

.audio-time {
  display: flex;
  justify-content: space-between;
  font-size: var(--fs-tiny);
  color: var(--cocoa);
  opacity: 0.6;
}

.play-btn {
  width: 56px;
  height: 56px;
  background: var(--rose-grad);
  border: none;
  border-radius: 50%;
  color: white;
  font-size: 24px;
  cursor: pointer;
  transition: var(--transition-base);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  position: relative;
  overflow: hidden;
}

.play-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 8px 20px rgba(237,106,167,0.3);
}

.play-btn:active {
  transform: scale(0.9);
}

/* Article Card Component */
.article-card {
  background: var(--bg-1);
  border-radius: var(--radius-xl);
  overflow: hidden;
  box-shadow: var(--shadow-sm);
  transition: var(--transition-base);
  cursor: pointer;
  border: 1px solid transparent;
}

.article-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-md);
  border-color: var(--gold);
}

.article-cover {
  width: 100%;
  height: 200px;
  background: linear-gradient(135deg, #FFB8D1, #FFCFE5);
  position: relative;
  overflow: hidden;
}

.article-cover img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: var(--transition-slow);
}

.article-card:hover .article-cover img {
  transform: scale(1.05);
}

.article-info {
  padding: var(--space-lg);
}

.article-meta {
  display: flex;
  align-items: center;
  gap: var(--space-md);
  margin-bottom: var(--space-md);
  font-size: var(--fs-small);
  color: var(--cocoa);
  opacity: 0.7;
}

.article-category {
  color: var(--rose);
  font-weight: 600;
  text-transform: uppercase;
  font-size: 12px;
  letter-spacing: 0.05em;
}

.article-title {
  font-family: var(--font-display);
  font-size: 24px;
  font-weight: 700;
  margin-bottom: var(--space-sm);
  color: var(--cocoa);
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.article-excerpt {
  font-size: 16px;
  color: var(--cocoa);
  opacity: 0.8;
  line-height: 1.6;
  margin-bottom: var(--space-md);
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Improved error handling */
.error-boundary {
  min-height: 400px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: var(--space-3xl);
  color: var(--cocoa);
}

.error-boundary h2 {
  font-size: 24px;
  margin-bottom: var(--space-md);
  color: var(--rose);
}

.error-boundary p {
  margin-bottom: var(--space-lg);
  opacity: 0.8;
}

/* Loading spinner */
.spinner {
  width: 40px;
  height: 40px;
  border: 4px solid var(--blush);
  border-top: 4px solid var(--rose);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 20px auto;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Toast notifications */
.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--rose);
  color: white;
  padding: var(--space-md) var(--space-lg);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  transform: translateX(100%);
  transition: transform 0.3s ease;
  z-index: var(--z-tooltip);
}

.toast.show {
  transform: translateX(0);
}

.toast.error {
  background: #DC2626;
}

.toast.success {
  background: #10B981;
}

.toast.warning {
  background: #F59E0B;
}

/* Print styles */
@media print {
  .navbar,
  .footer,
  .nav-mobile,
  .nav-overlay,
  .reading-progress,
  .theme-toggle,
  .menu-toggle {
    display: none !important;
  }
  
  .page {
    display: block !important;
  }
  
  body {
    background: white !important;
    color: black !important;
  }
}

/* ===== УЛУЧШЕННЫЙ TIMELINE С ПЛАВНОЙ АНИМАЦИЕЙ ПРИ СКРОЛЛЕ ===== */
.timeline {
  position: relative;
  padding: var(--space-2xl) 0;
  max-width: 900px;
  margin: 0 auto;
}

/* Основная золотая линия timeline */
.timeline::before {
  content: '';
  position: absolute;
  left: 50%;
  top: 0;
  width: 4px;
  background: linear-gradient(180deg, var(--gold) 0%, rgba(216, 166, 0, 0.3) 100%);
  transform: translateX(-50%);
  border-radius: 2px;
  z-index: 1;
  
  /* Начинаем с нулевой высоты и анимируем */
  height: 0%;
  transition: height 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

/* Класс для активации анимации линии */
.timeline.animate-line::before {
  height: 100%;
}

.timeline-item {
  position: relative;
  margin-bottom: var(--space-3xl);
  
  /* Начальное состояние для анимации */
  opacity: 0;
  transform: translateY(50px) scale(0.9);
  transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

/* Стили для четных и нечетных элементов */
.timeline-item:nth-child(odd) {
  padding-right: calc(50% + var(--space-2xl));
  text-align: right;
  transform: translateY(50px) translateX(-30px) scale(0.9);
}

.timeline-item:nth-child(even) {
  padding-left: calc(50% + var(--space-2xl));
  text-align: left;
  transform: translateY(50px) translateX(30px) scale(0.9);
}

/* Анимированное состояние элементов timeline */
.timeline-item.animate {
  opacity: 1;
  transform: translateY(0) translateX(0) scale(1);
}

/* Золотые точки на линии */
.timeline-dot {
  position: absolute;
  top: 20px;
  left: calc(50% - 14px);
  width: 28px;
  height: 28px;
  background: var(--gold);
  border: 6px solid var(--bg-0);
  border-radius: 50%;
  z-index: 3;
  
  /* Начальное состояние */
  transform: scale(0);
  transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

/* Анимация появления точек */
.timeline-item.animate .timeline-dot {
  transform: scale(1);
  animation: timeline-dot-pulse 2s ease-in-out infinite;
}

/* Пульсация точек */
@keyframes timeline-dot-pulse {
  0%, 100% { 
    box-shadow: 0 0 0 0 rgba(216, 166, 0, 0.4);
  }
  50% { 
    box-shadow: 0 0 0 15px rgba(216, 166, 0, 0);
  }
}

/* Карточки содержимого timeline */
.timeline-content {
  background: var(--bg-1);
  padding: var(--space-xl);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-md);
  position: relative;
  transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  border: 2px solid transparent;
  overflow: hidden;
}

/* Анимация при наведении */
.timeline-item.animate .timeline-content:hover {
  transform: translateY(-8px);
  box-shadow: var(--shadow-lg);
  border-color: var(--gold);
}

/* Стрелочки указывающие на центральную линию с улучшенной анимацией */
.timeline-item:nth-child(odd) .timeline-content::after {
  content: '';
  position: absolute;
  top: 20px;
  right: -14px;
  width: 0;
  height: 0;
  border-top: 14px solid transparent;
  border-bottom: 14px solid transparent;
  border-left: 14px solid var(--bg-1);
  transition: all 0.4s ease;
  opacity: 0;
  transform: translateX(-10px);
}

.timeline-item:nth-child(even) .timeline-content::after {
  content: '';
  position: absolute;
  top: 20px;
  left: -14px;
  width: 0;
  height: 0;
  border-top: 14px solid transparent;
  border-bottom: 14px solid transparent;
  border-right: 14px solid var(--bg-1);
  transition: all 0.4s ease;
  opacity: 0;
  transform: translateX(10px);
}

/* Показываем стрелочки при анимации */
.timeline-item.animate .timeline-content::after {
  opacity: 1;
  transform: translateX(0);
}

/* Стили для содержимого */
.timeline-date {
  font-size: 20px;
  color: var(--gold);
  font-weight: 700;
  margin-bottom: var(--space-sm);
  display: flex;
  align-items: center;
  gap: 8px;
  
  /* Анимация появления */
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.6s ease;
  transition-delay: 0.2s;
}

.timeline-item.animate .timeline-date {
  opacity: 1;
  transform: translateY(0);
}

.timeline-date::before {
  content: '✨';
  font-size: 18px;
  animation: rotate 3s linear infinite;
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.timeline-item:nth-child(odd) .timeline-date {
  justify-content: flex-end;
}

.timeline-title {
  font-family: var(--font-display);
  font-size: 24px;
  font-weight: 700;
  margin-bottom: var(--space-sm);
  color: var(--cocoa);
  
  /* Анимация появления */
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.6s ease;
  transition-delay: 0.4s;
}

.timeline-item.animate .timeline-title {
  opacity: 1;
  transform: translateY(0);
}

.timeline-description {
  font-size: 16px;
  color: var(--cocoa);
  opacity: 0.8;
  line-height: 1.6;
  
  /* Анимация появления */
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.6s ease;
  transition-delay: 0.6s;
}

.timeline-item.animate .timeline-description {
  opacity: 0.8;
  transform: translateY(0);
}

/* Дополнительные декоративные элементы */
.timeline-item::before {
  content: '';
  position: absolute;
  width: 200px;
  height: 200px;
  background: radial-gradient(circle, rgba(216, 166, 0, 0.05) 0%, transparent 70%);
  border-radius: 50%;
  top: -50px;
  opacity: 0;
  transition: opacity 0.8s ease;
  pointer-events: none;
}

.timeline-item:nth-child(odd)::before {
  right: -50px;
}

.timeline-item:nth-child(even)::before {
  left: -50px;
}

.timeline-item.animate::before {
  opacity: 1;
}

/* About Me Cards - новый компонент */
.about-me-card {
  background: var(--bg-1);
  border-radius: var(--radius-xl);
  padding: var(--space-xl);
  text-align: center;
  box-shadow: var(--shadow-md);
  transition: var(--transition-base);
  position: relative;
  overflow: hidden;
}

.about-me-card:hover {
  transform: translateY(-8px);
  box-shadow: var(--shadow-lg);
}

.about-me-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(237, 106, 167, 0.05) 0%, rgba(243, 151, 199, 0.05) 100%);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.about-me-card:hover::before {
  opacity: 1;
}

.about-me-icon {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  margin: 0 auto var(--space-lg);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 36px;
  color: white;
  position: relative;
  z-index: 1;
  animation: float 3s ease-in-out infinite;
}

.about-me-title {
  font-family: var(--font-display);
  font-size: 20px;
  font-weight: 700;
  margin-bottom: var(--space-sm);
  color: var(--cocoa);
  position: relative;
  z-index: 1;
}

.about-me-description {
  font-size: 15px;
  color: var(--cocoa);
  opacity: 0.8;
  line-height: 1.6;
  position: relative;
  z-index: 1;
}

/* Timeline адаптивность */
@media (max-width: 1024px) {
  .timeline::before { 
    left: 30px; 
    transform: none;
    margin-left: 0;
  }
  .timeline-item { 
    padding-left: 70px !important; 
    padding-right: 0 !important; 
    text-align: left !important; 
    transform: translateY(50px) translateX(0) scale(0.9) !important;
  }
  .timeline-dot { 
    left: 18px; /* 30px - 12px для центровки */
  }
  .timeline-item .timeline-content::after {
    display: none;
  }
  .timeline-item:nth-child(odd) .timeline-date {
    justify-content: flex-start;
  }
}

@media (max-width: 480px) {
  .timeline::before { 
    left: 20px; 
  }
  .timeline-item { 
    padding-left: 50px !important; 
    padding-right: 0 !important;
    text-align: left !important;
  }
  .timeline-dot { 
    left: 20px; 
  }
}

/* Адаптивность для карточек "О себе" */
@media (max-width: 1024px) {
  .about-me-card {
    padding: 30px 35px !important;
  }
  
  #about-content div[style*="grid-template-columns: repeat(3, 1fr)"] {
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 18px !important;
  }
}

@media (max-width: 768px) {
  #about-content .card {
    padding: 25px 20px !important;
    border-radius: 20px !important;
  }
  
  #about-content div[style*="grid-template-columns: repeat(3, 1fr)"] {
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 16px !important;
  }
  
  #about-content div[style*="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr))"] {
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 16px !important;
  }
  
  /* Уменьшаем размер социальных кнопок на мобильных */
  #about-content .social-link[style*="flex-direction: column"] {
    padding: 20px 16px !important;
    font-size: 14px !important;
    min-height: 100px !important;
  }
  
  #about-content .social-link svg {
    width: 28px !important;
    height: 28px !important;
  }
  
  /* Уменьшаем отступы секции "Давайте дружить!" на мобильных */
  #about-content div[style*="margin-top: 80px"] {
    margin-top: 60px !important;
    padding: 40px 20px !important;
  }
}
</style>
</head>
<body>
<!-- Skip link for screen readers -->
<a href="#main-content" class="skip-link">Перейти к основному контенту</a>

<!-- Reading Progress Bar -->
<div class="reading-progress" id="readingProgress" role="progressbar" aria-label="Прогресс чтения страницы"></div>

<!-- Navigation -->
<nav class="navbar" id="navbar" role="navigation" aria-label="Основная навигация">
  <div class="navbar-container container">
    <a href="#home" class="nav-brand" aria-label="Екатерина Новак - Главная страница">
      <div class="logo-circle">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
      </div>
      <div class="brand-text">
        <h1>Екатерина Новак</h1>
        <p>Писательница</p>
      </div>
    </a>
    
    <nav class="nav-menu" role="menubar">
      <a href="#home" class="nav-link active" data-page="home" role="menuitem" aria-label="Главная страница">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        <span>Главная</span>
      </a>
      <a href="#books" class="nav-link" data-page="books" role="menuitem" aria-label="Книги">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
          <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
        </svg>
        <span>Книги</span>
      </a>
      <a href="#audio" class="nav-link" data-page="audio" role="menuitem" aria-label="Аудиокниги">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
          <path d="M9 18V5l12-2v13"></path>
          <circle cx="6" cy="18" r="3"></circle>
          <circle cx="18" cy="16" r="3"></circle>
        </svg>
        <span>Аудио</span>
      </a>
      <a href="#encyclopedia" class="nav-link" data-page="encyclopedia" role="menuitem" aria-label="Энциклопедия">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
          <path d="M12 14l9-5-9-5-9 5 9 5z"></path>
          <path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 14v7"></path>
        </svg>
        <span>Энциклопедия</span>
      </a>
      <a href="#world" class="nav-link" data-page="world" role="menuitem" aria-label="Мир книг">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M2 12h20"></path>
          <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
        </svg>
        <span>Мир книг</span>
      </a>
      <a href="#articles" class="nav-link" data-page="articles" role="menuitem" aria-label="Статьи">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
        </svg>
        <span>Статьи</span>
      </a>
      <a href="#reviews" class="nav-link" data-page="reviews" role="menuitem" aria-label="Отзывы">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
        <span>Отзывы</span>
      </a>
      <a href="#about" class="nav-link" data-page="about" role="menuitem" aria-label="О писательнице">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
        <span>Обо мне</span>
      </a>
    </nav>
    
    <div class="nav-controls">
      <button class="theme-toggle" id="themeToggle" aria-label="Переключить тему оформления">
        <div class="theme-toggle-slider">
          <span id="themeIcon" aria-hidden="true">☀️</span>
        </div>
      </button>
      <button class="menu-toggle" id="menuToggle" aria-label="Открыть мобильное меню" aria-expanded="false">☰</button>
    </div>
  </div>
</nav>

<!-- Mobile Navigation -->
<div class="nav-overlay" id="navOverlay" aria-hidden="true"></div>
<nav class="nav-mobile" id="navMobile" role="navigation" aria-label="Мобильное меню" aria-hidden="true">
  <div class="nav-mobile-header">
    <h3>Меню</h3>
    <button class="nav-close" id="navClose" aria-label="Закрыть мобильное меню">✕</button>
  </div>
  <div class="nav-mobile-links">
    <a href="#home" class="nav-mobile-link" data-page="home">Главная</a>
    <a href="#books" class="nav-mobile-link" data-page="books">Книги</a>
    <a href="#audio" class="nav-mobile-link" data-page="audio">Аудио</a>
    <a href="#encyclopedia" class="nav-mobile-link" data-page="encyclopedia">Энциклопедия</a>
    <a href="#world" class="nav-mobile-link" data-page="world">Мир книг</a>
    <a href="#articles" class="nav-mobile-link" data-page="articles">Статьи</a>
    <a href="#reviews" class="nav-mobile-link" data-page="reviews">Отзывы</a>
    <a href="#about" class="nav-mobile-link" data-page="about">Обо мне</a>
  </div>
</nav>

<!-- Toast container for notifications -->
<div id="toastContainer" aria-live="polite" aria-atomic="true"></div>

<!-- Main Content -->
<main id="main-content" role="main">
  <!-- Home Page -->
  <div id="home" class="page active">
    <section class="hero">
      <div class="hero-bg"></div>
      <div class="hero-content">
        <h1 class="hero-title gradient-text">Исследуйте мой мир</h1>
        <p class="hero-subtitle">Детективные истории, фантастические приключения и романтические сюжеты — добро пожаловать в мою литературную вселенную. Создаю миры, где реальность встречается с мечтой!</p>
        <p class="font-quote gold hero-quote">«Каждая книга — это путешествие в новый мир»</p>
        <div class="hero-cta">
          <a href="#books" class="btn btn-large" data-page="books">Читать книги</a>
          <a href="#audio" class="btn btn-outline btn-large" data-page="audio">Слушать аудио</a>
        </div>
      </div>
    </section>
    
    <section class="section">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">Популярные разделы</h2>
          <p class="section-subtitle">Откройте для себя самые читаемые книги</p>
        </div>
        <div class="grid grid-cols-4" id="sections-grid">
          <!-- Section cards will be loaded here -->
        </div>
      </div>
    </section>
  </div>
  
  <!-- Books Page -->
  <div id="books" class="page">
    <section class="section">
      <div class="container">
        <div class="section-header">
          <h1 class="section-title gradient-text">Библиотека</h1>
          <p class="section-subtitle">Коллекция произведений Екатерины Новак: от захватывающих детективов до эпических фэнтези-приключений. Каждая книга — это новый мир для исследования.</p>
        </div>
        
        <!-- Фильтр по типу книги -->
        <div class="filter-tags" style="display: flex; gap: 12px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap;" role="group" aria-label="Фильтры по авторству">
          <button class="tag-pill active" data-book-type="all" aria-pressed="true">Все книги</button>
          <button class="tag-pill" data-book-type="solo" aria-pressed="false">Мои книги</button>
          <button class="tag-pill" data-book-type="coauthor" aria-pressed="false">В соавторстве с Анной Камской</button>
        </div>
        
        <!-- Фильтр по жанрам -->
        <div class="filter-tags" style="display: flex; gap: 12px; justify-content: center; margin-bottom: 40px; flex-wrap: wrap;" role="group" aria-label="Фильтры по жанрам">
          <button class="tag-pill active" data-filter="all" aria-pressed="true">Все жанры</button>
          <button class="tag-pill" data-filter="detective" aria-pressed="false">Детективы</button>
          <button class="tag-pill" data-filter="fantasy" aria-pressed="false">Фэнтези</button>
          <button class="tag-pill" data-filter="romance" aria-pressed="false">Романы</button>
          <button class="tag-pill" data-filter="mystic" aria-pressed="false">Мистика</button>
          <button class="tag-pill" data-filter="slr" aria-pressed="false">СЛР</button>
          <button class="tag-pill" data-filter="young-adult" aria-pressed="false">Янг эдалт</button>
        </div>
        
        <div class="grid grid-cols-4" id="books-grid">
          <!-- Books will be loaded here -->
        </div>
      </div>
    </section>
  </div>
  
  <!-- Book Detail Page -->
  <div id="book-detail" class="page">
    <div class="container">
      <div id="book-detail-content">
        <!-- Book detail content will be loaded here -->
      </div>
    </div>
  </div>
  
  <!-- Audio Page -->
  <div id="audio" class="page">
    <section class="section">
      <div class="container">
        <div class="section-header">
          <h1 class="section-title gradient-text">Аудио</h1>
          <p class="section-subtitle">Погрузитесь в мир моих историй с профессиональной озвучкой. Слушайте любимые произведения в дороге, дома или на прогулке.</p>
        </div>
        <div style="display: flex; gap: 16px; justify-content: center; margin-bottom: 40px;">
          <button class="btn" id="audiobooks-btn">Аудиокниги</button>
          <button class="btn btn-outline" id="podcasts-btn">Подкасты</button>
        </div>
        <div id="audio-content">
          <!-- Audio content will be loaded here -->
        </div>
      </div>
    </section>
  </div>
  
  <!-- Encyclopedia Page -->
  <div id="encyclopedia" class="page">
    <section class="section">
      <div class="container">
        <div class="section-header">
          <h1 class="section-title gradient-text">Энциклопедия</h1>
          <p class="section-subtitle">Подробная информация о всех моих книгах</p>
        </div>
        <div class="encyclopedia-nav" style="display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; margin-bottom: 40px;">
          <!-- Encyclopedia navigation will be loaded here -->
        </div>
        <div id="encyclopedia-content">
          <!-- Encyclopedia content will be loaded here -->
        </div>
      </div>
    </section>
  </div>
  
  <!-- World Page -->
  <div id="world" class="page">
    <section class="section">
      <div class="container">
        <div class="section-header">
          <h1 class="section-title gradient-text">Мир книг</h1>
          <p class="section-subtitle">Погрузитесь в детали каждой вселенной</p>
        </div>
        <div style="display: flex; gap: 16px; justify-content: center; margin-bottom: 40px; flex-wrap: wrap;">
          <button class="btn" id="characters-btn">Персонажи</button>
          <button class="btn btn-outline" id="quiz-btn">Квизы</button>
          <button class="btn btn-outline" id="map-btn">Карта</button>
        </div>
        <div id="world-content">
          <!-- World content will be loaded here -->
        </div>
      </div>
    </section>
  </div>
  
  <!-- Articles Page -->
  <div id="articles" class="page">
    <section class="section">
      <div class="container">
        <div class="section-header">
          <h1 class="section-title gradient-text">Статьи</h1>
          <p class="section-subtitle">Делюсь опытом, размышлениями о творчестве и секретами писательского мастерства. Здесь вы найдете вдохновение и практические советы.</p>
        </div>
        <div id="articles-content" style="max-width: 800px; margin: 0 auto;">
          <!-- Articles will be loaded here -->
        </div>
      </div>
    </section>
  </div>
  
  <!-- Reviews Page -->
  <div id="reviews" class="page">
    <section class="section">
      <div class="container">
        <div class="section-header">
          <h1 class="section-title gradient-text">Отзывы блогеров</h1>
          <p class="section-subtitle">Что говорят о моих книгах известные блогеры</p>
        </div>
        <div class="grid grid-cols-2" id="reviews-content">
          <!-- Reviews will be loaded here -->
        </div>
      </div>
    </section>
  </div>
  
  <!-- About Page -->
  <div id="about" class="page">
    <section class="section">
      <div class="container" style="max-width: 800px;">
        <div class="section-header">
          <h1 class="section-title gradient-text">О себе</h1>
        </div>
        <div id="about-content">
          <!-- About content will be loaded here -->
        </div>
      </div>
    </section>
  </div>
  
  <!-- Article Detail Page -->
  <div id="article-detail" class="page">
    <section class="section">
      <div class="container" style="max-width: 800px;">
        <div id="article-detail-content">
          <!-- Article detail content will be loaded here -->
        </div>
      </div>
    </section>
  </div>
  
  <!-- Character Detail Page -->
  <div id="character-detail" class="page">
    <div class="container">
      <div id="character-detail-content">
        <!-- Character detail content will be loaded here -->
      </div>
    </div>
  </div>
</main>

<!-- Footer -->
<footer class="footer" role="contentinfo">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section" style="flex: 1.5;">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
          <div class="logo-circle" style="animation: heartbeat 3s ease-in-out infinite;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
          </div>
          <div>
            <h3 style="font-family: var(--font-script); font-size: 24px; font-weight: 400; margin: 0;">Екатерина Новак</h3>
            <p style="font-size: 13px; color: var(--rose); margin: 0;">Писательница</p>
          </div>
        </div>
        <p style="font-size: 15px; line-height: 1.6; margin-bottom: 20px;">Создаю литературные миры, где магические приключения переплетаются с детективными интригами. Каждая история — это путешествие в глубины человеческой души.</p>
        <div class="footer-social">
          <a href="https://vk.com" class="social-link" target="_blank" rel="noopener" aria-label="ВКонтакте">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M15.684 0H8.316C1.592 0 0 1.592 0 8.316v7.368C0 22.408 1.592 24 8.316 24h7.368C22.408 24 24 22.408 24 15.684V8.316C24 1.592 22.408 0 15.684 0zm3.692 17.123h-1.744c-.66 0-.864-.525-2.05-1.727-1.033-1-1.49-1.135-1.744-1.135-.356 0-.458.102-.458.593v1.575c0 .424-.135.678-1.253.678-1.846 0-3.896-1.118-5.335-3.202C4.624 10.857 4 8.57 4 8.096c0-.254.102-.491.593-.491h1.744c.44 0 .61.203.78.677.863 2.49 2.303 4.675 2.896 4.675.22 0 .322-.102.322-.66V9.721c-.068-1.186-.695-1.287-.695-1.71 0-.204.17-.407.44-.407h2.744c.373 0 .508.203.508.643v3.473c0 .372.17.508.271.508.22 0 .407-.136.813-.542 1.27-1.422 2.18-3.61 2.18-3.61.119-.254.322-.491.762-.491h1.744c.525 0 .644.27.525.643-.22 1.017-2.354 4.031-2.354 4.031-.186.305-.254.44 0 .78.186.254.796.779 1.203 1.253.745.847 1.32 1.558 1.473 2.05.17.491-.085.745-.576.745z"/>
            </svg>
          </a>
          <a href="https://t.me" class="social-link" target="_blank" rel="noopener" aria-label="Телеграм">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.2-1.3l15.97-6.16c.73-.33 1.43.18 1.15 1.3l-2.72 12.81c-.19.91-.74 1.13-1.5.71L12.6 16.3l-1.99 1.93c-.23.23-.42.42-.83.42z"/>
            </svg>
          </a>
          <a href="https://youtube.com" class="social-link" target="_blank" rel="noopener" aria-label="YouTube">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
            </svg>
          </a>
          <a href="https://yappy.media" class="social-link" target="_blank" rel="noopener" aria-label="Yappy">🎵</a>
          <a href="https://dzen.ru" class="social-link" target="_blank" rel="noopener" aria-label="Дзен">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M12 0C5.372 0 0 5.372 0 12s5.372 12 12 12 12-5.372 12-12S18.628 0 12 0zm0 2c5.514 0 10 4.486 10 10s-4.486 10-10 10S2 17.514 2 12 6.486 2 12 2zm0 3.5c-3.59 0-6.5 2.91-6.5 6.5s2.91 6.5 6.5 6.5 6.5-2.91 6.5-6.5-2.91-6.5-6.5-6.5z"/>
            </svg>
          </a>
        </div>
      </div>
      <div class="footer-section">
        <h3>Книги</h3>
        <a href="#books" class="footer-link" data-page="books">Все книги</a>
        <a href="#audio" class="footer-link" data-page="audio">Аудиокниги</a>
        <a href="#encyclopedia" class="footer-link" data-page="encyclopedia">Энциклопедия</a>
        <a href="#world" class="footer-link" data-page="world">Мир книг</a>
      </div>
      <div class="footer-section">
        <h3>Контент</h3>
        <a href="#articles" class="footer-link" data-page="articles">Статьи</a>
        <a href="#reviews" class="footer-link" data-page="reviews">Отзывы блогеров</a>
        <a href="#about" class="footer-link" data-page="about">Обо мне</a>
        <a href="#" class="footer-link">PR Kit для блогеров</a>
      </div>
      <div class="footer-section">
        <h3>Информация</h3>
        <a href="#contacts" class="footer-link">Контакты</a>
        <a href="mailto:contact@ekaterina-novak.ru" class="footer-link">Email</a>
        <a href="#" class="footer-link">Политика конфиденциальности</a>
        <a href="#" class="footer-link">Отзывы читателей</a>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2016-2025 Екатерина Новак. Все права защищены.</p>
    </div>
  </div>
</footer>

<script>
// Utility functions
function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

function showToast(message, type = 'info') {
  const container = document.getElementById('toastContainer');
  if (!container) return;
  
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.textContent = message;
  
  container.appendChild(toast);
  
  // Show toast
  setTimeout(() => toast.classList.add('show'), 100);
  
  // Remove toast
  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => container.removeChild(toast), 300);
  }, 3000);
}

function showLoading(container) {
  container.innerHTML = '<div class="spinner" role="status" aria-label="Загрузка..."></div>';
}

function showError(container, message = 'Произошла ошибка при загрузке данных') {
  container.innerHTML = `
    <div class="error-boundary">
      <h2>Упс! Что-то пошло не так</h2>
      <p>${message}</p>
      <button class="btn" onclick="location.reload()">Обновить страницу</button>
    </div>
  `;
}

// Error boundary
class ErrorBoundary {
  static handle(error, container) {
    console.error('Application error:', error);
    showError(container);
    showToast('Произошла ошибка. Попробуйте обновить страницу.', 'error');
  }
}

// Performance monitoring
if ('requestIdleCallback' in window) {
  requestIdleCallback(() => {
    // Lazy load non-critical features
    console.log('🚀 Application ready');
  });
}

// Data
let data = {
  sections: [],
  books: [],
  articles: [],
  articles_full: [],
  characters: [],
  reviews: [],
  audiobooks: [],
  podcasts: [],
  settings: {}
};

// URL для Google Sheets API
const SHEETS_API_URL = 'https://script.google.com/macros/s/AKfycbwh-NOQVK-Ur2V5cWkcQDSq_J_3qtQyXSBg89UjldZl57GUVmrILPdDqK_DXA2-fJLEjQ/exec';

// ОТЛАДКА - добавьте эти строки
console.log('🔍 SHEETS_API_URL:', SHEETS_API_URL);
console.log('🔍 URL настроен:', SHEETS_API_URL && SHEETS_API_URL.includes('script.google.com'));

// Проверяем, настроен ли URL
const isSheetsConfigured = SHEETS_API_URL && SHEETS_API_URL.includes('script.google.com');

// Загрузка данных из Google Sheets с улучшенной обработкой ошибок
async function loadDataFromSheets() {
  if (!isSheetsConfigured) {
    console.log('❌ Google Sheets API не настроен. Используются демо-данные.');
    return;
  }
  
  console.log('🔄 Начинаем загрузку данных из Google Sheets...');
  
  try {
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 8000); // 8 секунд таймаут
    
    const response = await fetch(SHEETS_API_URL, {
      signal: controller.signal,
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      }
    });
    
    clearTimeout(timeoutId);
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const sheetData = await response.json();
    
    // Обновляем локальные данные
    data = {
      ...data,
      ...sheetData
    };
    
    // Если есть полные статьи, объединяем их с обычными
    if (sheetData.articles_full && sheetData.articles_full.length > 0) {
      data.articles_full = sheetData.articles_full;
    }
    
    // Применяем настройки сайта
    if (data.settings) {
      applySettings(data.settings);
    }
    
    // Перезагружаем текущую страницу с новыми данными
    loadPageContent(currentPage);
    
    console.log('✅ Данные из Google Sheets успешно загружены!');
    showToast('Данные обновлены!', 'success');
    
  } catch (error) {
    const errorMessage = error.name === 'AbortError' ? 'Таймаут загрузки' : error.message;
    console.error('❌ Ошибка при загрузке данных:', errorMessage);
    console.log('📄 Используются демо-данные.');
    showToast('Не удалось загрузить данные. Используются демо-данные.', 'warning');
  }
}

// Применение настроек из таблицы
function applySettings(settings) {
  try {
    // Обновляем заголовок сайта
    if (settings.site_title) {
      document.title = settings.site_title;
    }
    
    // Обновляем bio в футере
    const bioElement = document.querySelector('.footer-section p');
    if (bioElement && settings.bio) {
      bioElement.textContent = settings.bio;
    }
    
    // Обновляем ссылки на соцсети
    const socialLinks = {
      vk_url: 'a[href*="vk.com"]',
      telegram_url: 'a[href*="t.me"]',
      youtube_url: 'a[href*="youtube.com"]',
      yappy_url: 'a[href*="yappy.media"]',
      dzen_url: 'a[href*="dzen.ru"]'
    };
    
    Object.entries(socialLinks).forEach(([key, selector]) => {
      if (settings[key]) {
        const link = document.querySelector(selector);
        if (link) link.href = settings[key];
      }
    });
    
    // Обновляем email
    const emailLinks = document.querySelectorAll('a[href^="mailto:"]');
    if (emailLinks.length && settings.email) {
      emailLinks.forEach(link => {
        link.href = `mailto:${settings.email}`;
      });
    }
  } catch (error) {
    console.error('Ошибка при применении настроек:', error);
  }
}

// Простой Markdown парсер - улучшенная версия
function parseMarkdown(text) {
  if (!text || typeof text !== 'string') return '';
  
  try {
    // Ограничиваем размер текста для парсинга
    if (text.length > 50000) {
      console.warn('Текст слишком длинный для парсинга');
      return text.substring(0, 50000) + '...';
    }
    
    // Сохраняем блоки кода
    const codeBlocks = [];
    text = text.replace(/```([\s\S]*?)```/g, (match, code) => {
      codeBlocks.push(code);
      return `__CODE_BLOCK_${codeBlocks.length - 1}__`;
    });
    
    // Экранируем HTML
    text = text.replace(/</g, '&lt;').replace(/>/g, '&gt;');
    
    // Заголовки
    text = text.replace(/^### (.*$)/gim, '<h3>$1</h3>');
    text = text.replace(/^## (.*$)/gim, '<h2>$1</h2>');
    text = text.replace(/^# (.*$)/gim, '<h1>$1</h1>');
    
    // Жирный и курсив
    text = text.replace(/\*\*\*(.*?)\*\*\*/g, '<strong><em>$1</em></strong>');
    text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
    text = text.replace(/__(.*?)__/g, '<strong>$1</strong>');
    text = text.replace(/_(.*?)_/g, '<em>$1</em>');
    
    // Цитаты
    text = text.replace(/^> (.*$)/gim, '<blockquote>$1</blockquote>');
    
    // Ссылки
    text = text.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>');
    
    // Горизонтальная линия
    text = text.replace(/^---$/gim, '<hr>');
    text = text.replace(/^\*\*\*$/gim, '<hr>');
    
    // Инлайн код
    text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
    
    // Восстанавливаем блоки кода
    text = text.replace(/__CODE_BLOCK_(\d+)__/g, (match, index) => {
      return `<pre><code>${codeBlocks[index] || ''}</code></pre>`;
    });
    
    // Параграфы (упрощенная версия)
    text = text.split('\n\n').map(paragraph => {
      paragraph = paragraph.trim();
      if (paragraph && 
          !paragraph.startsWith('<h') && 
          !paragraph.startsWith('<ul') && 
          !paragraph.startsWith('<ol') && 
          !paragraph.startsWith('<blockquote') &&
          !paragraph.startsWith('<hr') &&
          !paragraph.startsWith('<pre')) {
        return `<p>${paragraph}</p>`;
      }
      return paragraph;
    }).join('\n');
    
    // Чистка
    text = text.replace(/<p><\/p>/g, '');
    text = text.replace(/\n/g, ' ');
    text = text.replace(/<\/blockquote> <blockquote>/g, '</blockquote><blockquote>');
    
    return text;
  } catch (error) {
    console.error('Ошибка при парсинге Markdown:', error);
    return text; // Возвращаем исходный текст в случае ошибки
  }
}

// Загрузка дефолтных данных (fallback)
function loadDefaultData() {
  console.log('📄 Загружаем демо-данные...');
  
  data = {
  sections: [
    {
      id: 'books',
      title: 'Книги',
      description: 'Все мои произведения',
      icon: '📚',
      color1: '#FFB8D1',
      color2: '#FFCFE5'
    },
    {
      id: 'audio',
      title: 'Аудио',
      description: 'Книги и подкасты',
      icon: '🎧',
      color1: '#D4B5F5',
      color2: '#E4D5F7'
    },
    {
      id: 'encyclopedia',
      title: 'Энциклопедия',
      description: 'Детали о книгах',
      icon: '📖',
      color1: '#94E4D9',
      color2: '#B0EDE5'
    },
    {
      id: 'world',
      title: 'Мир книг',
      description: 'Персонажи и карты',
      icon: '🌍',
      color1: '#87C4E9',
      color2: '#A5D6F3'
    },
    {
      id: 'articles',
      title: 'Статьи',
      description: 'Блог о литературе',
      icon: '✍️',
      color1: '#FFEC8B',
      color2: '#FFF2B3'
    },
    {
      id: 'reviews',
      title: 'Отзывы',
      description: 'Мнения блогеров',
      icon: '💬',
      color1: '#FFC3A1',
      color2: '#FFD4BA'
    },
    {
      id: 'about',
      title: 'Обо мне',
      description: 'Моя история',
      icon: '👩‍💼',
      color1: '#FFCAA6',
      color2: '#FFD8BF'
    }
  ],
  books: [
    {
      id: 1,
      title: "Проклятье Черной Мадонны",
      series: "Дилетантки #1",
      description: "Первая книга из серии детективов о приключениях Александры Покровской",
      genre: "detective",
      rating: 4.8,
      reviews: 234,
      character_ids: [1],
      coauthor: false
    },
    {
      id: 2,
      title: "Тайна Долины Инферин",
      series: "Долина Инферин #1",
      description: "Магический мир, где судьбы героев переплетаются с древними пророчествами",
      genre: "fantasy",
      rating: 4.9,
      reviews: 189,
      character_ids: [2, 3],
      coauthor: false
    },
    {
      id: 3,
      title: "Самая красивая",
      series: "",
      description: "Современный роман о любви, предательстве и прощении",
      genre: "romance",
      rating: 4.7,
      reviews: 156,
      character_ids: [],
      coauthor: false
    },
    {
      id: 4,
      title: "Тени прошлого",
      series: "Мистические истории #1",
      description: "Загадочная история о доме с привидениями и семейных тайнах",
      genre: "mystic",
      rating: 4.6,
      reviews: 178,
      character_ids: [],
      coauthor: "Анна Камская"
    },
    {
      id: 5,
      title: "Академия теней",
      series: "Темная академия #1",
      description: "Магическая академия, где студенты изучают темные искусства",
      genre: "young-adult",
      rating: 4.8,
      reviews: 267,
      character_ids: [],
      coauthor: false
    },
    {
      id: 6,
      title: "Сердце дракона",
      series: "СЛР вселенная #1",
      description: "Эпическая история о любви и приключениях в мире драконов",
      genre: "slr",
      rating: 4.9,
      reviews: 312,
      character_ids: [],
      coauthor: "Анна Камская"
    }
  ],
  characters: [
    {
      id: 1,
      name: "Александра Покровская",
      age: "28 лет",
      role: "Детектив-любитель",
      origin: "Москва, современная Россия",
      appearance: "Овальное лицо с мягкими чертами, темно-каштановые волосы до плеч, карие миндалевидные глаза, стройная фигура среднего роста, маленький шрам на левой брови",
      style: "Элегантный casual: джинсы, блузки, удобная обувь. Предпочитает пастельные тона, всегда носит серебряные часы - подарок отца",
      manners: "Прямая осанка, уверенная походка, мелодичный голос, привычка прикусывать губу в задумчивости",
      traits: "Наблюдательная, упорная, эмпатичная, остроумная, независимая",
      values: "Справедливость, дружба, поиск истины",
      weaknesses: "Боится высоты, избегает конфликтов с близкими",
      superpower: "Способность замечать детали, которые другие упускают",
      motto: "В каждой загадке есть ключ - нужно только его найти",
      emoji: "🕵️‍♀️",
      skills: ["Дедукция", "Интуиция", "Храбрость"],
      description: "Умная и находчивая героиня серии «Дилетантки»"
    },
    {
      id: 2,
      name: "Эльза Винтерборн",
      age: "125 лет",
      role: "Маг-целитель высшего круга",
      origin: "Северные земли Долины Инферин",
      appearance: "Аристократическое лицо с высокими скулами, серебристо-белые длинные волосы в сложной косе, ледяно-голубые глаза светящиеся при использовании магии, высокая грациозная фигура, руны защиты на запястьях",
      style: "Длинные мантии из эльфийского шелка, практичные дорожные платья. Предпочитает оттенки синего и серебряного, носит магические амулеты и посох из лунного дерева",
      manners: "Королевская осанка, плавные движения, мягкий успокаивающий голос с легким северным акцентом, сдержанные элегантные жесты",
      traits: "Мудрая, сострадательная, терпеливая, загадочная, самоотверженная",
      values: "Защита невинных, баланс природы, древние традиции",
      weaknesses: "Слишком доверчива, тяжело переживает потери",
      superpower: "Исцеление любых ран и способность видеть истинную суть людей",
      motto: "Магия - это ответственность, а не привилегия",
      emoji: "🧙‍♀️",
      skills: ["Целительство", "Древняя магия", "Мудрость"],
      description: "Добрая волшебница из Долины Инферин"
    },
    {
      id: 3,
      name: "Граф Теодор фон Равенкрофт",
      age: "35 лет",
      role: "Таинственный аристократ и дипломат",
      origin: "Древний род из Восточных провинций",
      appearance: "Точеные черты лица, аристократический профиль, черные как вороново крыло волосы, серые проницательные глаза, высокий рост, атлетическое телосложение фехтовальщика, едва заметный шрам на правой скуле",
      style: "Безупречные костюмы-тройки, плащи с серебряной застежкой. Предпочитает черный, темно-серый и бордовый цвета, носит фамильный перстень с рубином и трость с потайным клинком",
      manners: "Идеальная выправка военного, бесшумная походка, бархатный баритон, сдержанные точные движения, привычка играть перстнем в задумчивости",
      traits: "Харизматичный, расчетливый, благородный, скрытный, преданный",
      values: "Честь рода, верность слову, защита тех кого любит",
      weaknesses: "Гордость, сложно доверяет людям, преследует прошлое",
      superpower: "Мастер манипуляций и способность читать людей как открытую книгу",
      motto: "В игре теней побеждает тот, кто управляет светом",
      emoji: "🎩",
      skills: ["Дипломатия", "Фехтование", "Тайны"],
      description: "Загадочный персонаж с неоднозначным прошлым"
    }
  ],
  articles: [
    {
      title: "Как я пишу детективы",
      date: "2024-01-15",
      read_time: 5,
      views: 1234,
      likes: 89,
      excerpt: "Делюсь своими секретами создания захватывающих детективных сюжетов"
    },
    {
      title: "Мир Долины Инферин: создание вселенной",
      date: "2024-02-10",
      read_time: 8,
      views: 987,
      likes: 124,
      excerpt: "Рассказываю о том, как создавался фэнтезийный мир моих книг"
    },
    {
      title: "Персонажи, которые оживают",
      date: "2024-03-05",
      read_time: 6,
      views: 765,
      likes: 92,
      excerpt: "Секреты создания запоминающихся и живых персонажей"
    }
  ],
  articles_full: [
    {
      id: 1,
      slug: "kak-ya-pishu-detectivy",
      title: "Как я пишу детективы",
      date: "2024-01-15",
      read_time: 5,
      author: "Екатерина Новак",
      category: "Творчество",
      tags: "писательство, детективы, процесс",
      excerpt: "Делюсь своими секретами создания захватывающих детективных сюжетов",
      content: `# Вступление

Многие читатели спрашивают меня: **как рождаются мои детективы?** Сегодня я решила приоткрыть завесу тайны и рассказать о своем творческом процессе.

## Все начинается с идеи

> Хороший детектив — это не просто загадка, это путешествие в человеческую душу.

Каждая моя книга начинается с простого вопроса: *"А что если?"* Что если обычная домохозяйка окажется в центре международного заговора? Что если древнее проклятие окажется изощренным убийством?

### Мои главные принципы:

1. **Честная игра с читателем** — все улики должны быть на виду
2. **Живые персонажи** — даже злодей должен вызывать эмоции
3. **Неожиданная развязка** — но логически обоснованная

## Процесс создания сюжета

Я всегда начинаю с конца. Да-да, именно так! Сначала придумываю:

- Кто убийца
- Какой мотив
- Как было совершено преступление

И только потом начинаю *раскручивать* историю назад, добавляя:

* Ложные следы
* Подозреваемых
* Второстепенные линии

---

## Работа над персонажами

Мои герои — это не просто функции в сюжете. У каждого есть:

**Прошлое** → **Мотивация** → **Цель**

Я веду отдельную тетрадь, где записываю даже те детали, которые никогда не попадут в книгу. Любимый цвет героя, его детские травмы, привычки...

### Пример из практики

Когда я создавала Александру Покровскую, я знала, что она:
- Боится высоты (из-за детской травмы)
- Всегда носит часы отца
- Не может пройти мимо букинистического магазина

## Атмосфера и детали

\`Дьявол кроется в деталях\` — это мой девиз. Каждая сцена должна работать на атмосферу:

\`\`\`
Туман окутывал старый особняк, словно саван.
В окнах не горел свет, только луна отражалась
в разбитом витраже третьего этажа...
\`\`\`

## Заключение

Написание детектива — это как **расследование наоборот**. Вы знаете ответ и должны создать загадку. И помните: читатель должен воскликнуть *"Как же я сам не догадался!"*, а не *"Откуда это взялось?"*

Творите, дерзайте, и пусть ваши истории захватывают сердца!

***

*Делитесь в комментариях, что вам больше всего нравится в детективах?*`
    },
    {
      id: 2,
      slug: "mir-doliny-inferin",
      title: "Мир Долины Инферин: создание вселенной",
      date: "2024-02-10",
      read_time: 8,
      author: "Екатерина Новак",
      category: "Мир книг",
      tags: "фэнтези, worldbuilding, Долина Инферин",
      excerpt: "Рассказываю о том, как создавался фэнтезийный мир моих книг",
      content: `# Рождение Долины Инферин

Создание фэнтезийного мира — это **волшебство**, доступное каждому писателю. Сегодня я расскажу, как появилась Долина Инферин.

## С чего все началось

Идея пришла во сне. Я увидела долину, окутанную туманом, где магия текла рекой, а древние тайны скрывались под каждым камнем.

> Каждый мир начинается с одного образа, одного чувства, одной мечты.

### Первые наброски

В моем блокноте появились:
- Карта долины (кривая и непонятная)
- Имена первых персонажей
- Основные законы магии

## Создание истории мира

История Долины Инферин насчитывает **тысячи лет**. Я разработала:

1. **Эпоху Основания** — когда первые маги пришли в долину
2. **Войны Стихий** — великий конфликт, изменивший мир
3. **Время Затишья** — современная эпоха

## Магическая система

Магия в моем мире подчиняется строгим правилам:

* __Закон сохранения__: магия не создает из ничего
* __Закон цены__: за все нужно платить
* __Закон баланса__: свет порождает тьму

---

Продолжение следует...`
    }
  ],
  reviews: [
    {
      author: "Книжная Фея",
      handle: "@book_fairy",
      rating: 5,
      text: "Екатерина Новак — мастер интриги! Её детективы держат в напряжении до последней страницы. Обожаю серию «Дилетантки»!",
      likes: 234,
      comments: 45,
      avatar_color1: "#FFB8D1",
      avatar_color2: "#FFCFE5"
    },
    {
      author: "Литературный критик",
      handle: "@lit_critic",
      rating: 5,
      text: "Редко встречаешь автора, который одинаково хорошо пишет и детективы, и фэнтези. Екатерина — именно такой талант!",
      likes: 189,
      comments: 32,
      avatar_color1: "#D4B5F5",
      avatar_color2: "#E4D5F7"
    },
    {
      author: "Читающая Москва",
      handle: "@reading_moscow",
      rating: 4,
      text: "Долина Инферин — это невероятный мир, в который хочется возвращаться снова и снова. Жду продолжения!",
      likes: 156,
      comments: 28,
      avatar_color1: "#94E4D9",
      avatar_color2: "#B0EDE5"
    }
  ],
  audiobooks: [
    {
      id: 1,
      book_id: 1,
      narrator: "Мария Иванова",
      duration: "8:45:00",
      progress_demo: 35
    },
    {
      id: 2,
      book_id: 2,
      narrator: "Алексей Петров",
      duration: "12:30:00",
      progress_demo: 0
    }
  ],
  podcasts: [
    {
      id: 1,
      episode: 1,
      title: "Как начать писать",
      description: "О первых шагах в литературе",
      duration: 45,
      date: "2024-01-01"
    },
    {
      id: 2,
      episode: 2,
      title: "Создание персонажей",
      description: "Секреты живых и запоминающихся героев",
      duration: 52,
      date: "2024-01-15"
    }
  ]
};
  
  console.log('✅ Демо-данные загружены успешно');
}

// App State
let currentPage = 'home';
let currentAudioSection = 'audiobooks';
let currentWorldSection = 'characters';
let currentFilter = 'all';
let currentBookType = 'all';
let currentEncyclopediaSection = 0;
let quizProgress = 0;
let currentBookId = null;
let currentCharacterId = null;
let currentArticleSlug = null;

// DOM Elements
const navbar = document.getElementById('navbar');
const themeToggle = document.getElementById('themeToggle');
const themeIcon = document.getElementById('themeIcon');
const menuToggle = document.getElementById('menuToggle');
const navOverlay = document.getElementById('navOverlay');
const navMobile = document.getElementById('navMobile');
const navClose = document.getElementById('navClose');
const readingProgress = document.getElementById('readingProgress');

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  try {
    // Сначала загружаем дефолтные данные и инициализируем интерфейс
    loadDefaultData();
    
    initTheme();
    initNavigation();
    initScrollEffects();
    
    // Определяем начальную страницу из URL hash
    const hash = window.location.hash.slice(1);
    const validPages = ['home', 'books', 'audio', 'encyclopedia', 'world', 'articles', 'reviews', 'about', 'book-detail', 'character-detail', 'article-detail'];
    const initialPage = validPages.includes(hash) ? hash : 'home';
    
    navigateTo(initialPage, false);
    
    // Загружаем данные из Google Sheets в фоне БЕЗ блокировки интерфейса
    setTimeout(() => {
      loadDataFromSheets().catch(err => {
        console.log('Продолжаем работу с демо-данными');
      });
    }, 100);
    
  } catch (error) {
    ErrorBoundary.handle(error, document.getElementById('main-content'));
  }
});

// Theme System
function initTheme() {
  try {
    const savedTheme = localStorage.getItem('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    
    if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
      document.documentElement.classList.add('dark');
      themeIcon.textContent = '🌙';
    }
    
    themeToggle.addEventListener('click', toggleTheme);
  } catch (error) {
    console.error('Ошибка инициализации темы:', error);
  }
}

function toggleTheme() {
  try {
    const isDark = document.documentElement.classList.toggle('dark');
    themeIcon.textContent = isDark ? '🌙' : '☀️';
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  } catch (error) {
    console.error('Ошибка переключения темы:', error);
  }
}

// Navigation
function initNavigation() {
  try {
    // Brand logo
    const navBrand = document.querySelector('.nav-brand');
    if (navBrand) {
      navBrand.addEventListener('click', (e) => {
        e.preventDefault();
        navigateTo('home');
      });
    }
    
    // Navigation links
    document.querySelectorAll('.nav-link, .nav-mobile-link, .footer-link').forEach(link => {
      if (link.classList.contains('social-link') || link.target === '_blank') return;
      
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const page = link.dataset.page || link.getAttribute('href')?.replace('#', '');
        if (page && page !== '#' && page !== '') {
          navigateTo(page);
        }
      });
    });
    
    // Mobile menu
    if (menuToggle) menuToggle.addEventListener('click', openMobileMenu);
    if (navClose) navClose.addEventListener('click', closeMobileMenu);
    if (navOverlay) navOverlay.addEventListener('click', closeMobileMenu);
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && navMobile.classList.contains('active')) {
        closeMobileMenu();
      }
    });
    
  } catch (error) {
    console.error('Ошибка инициализации навигации:', error);
  }
}

function navigateTo(page, updateUrl = true) {
  if (currentPage === page && page !== 'book-detail' && page !== 'character-detail' && page !== 'article-detail') return;
  
  try {
    // Update active states
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    const targetPage = document.getElementById(page);
    if (targetPage) {
      targetPage.classList.add('active');
    }
    
    // Update navigation aria states
    document.querySelectorAll('.nav-link, .nav-mobile-link').forEach(link => {
      const isActive = link.dataset.page === page;
      link.classList.toggle('active', isActive);
      link.setAttribute('aria-current', isActive ? 'page' : 'false');
    });
    
    // Update filter button aria states
    document.querySelectorAll('[data-filter], [data-book-type]').forEach(btn => {
      btn.setAttribute('aria-pressed', btn.classList.contains('active'));
    });
    
    currentPage = page;
    
    // Update URL
    if (updateUrl) {
      window.location.hash = page;
    }
    
    // Load content
    loadPageContent(page);
    
    // Close mobile menu
    closeMobileMenu();
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
    
    // Focus management for accessibility
    const mainContent = document.getElementById('main-content');
    if (mainContent) {
      mainContent.focus();
    }
    
  } catch (error) {
    console.error('Ошибка навигации:', error);
    ErrorBoundary.handle(error, document.getElementById('main-content'));
  }
}

function openMobileMenu() {
  try {
    navMobile.classList.add('active');
    navOverlay.classList.add('active');
    navMobile.setAttribute('aria-hidden', 'false');
    menuToggle.setAttribute('aria-expanded', 'true');
    document.body.style.overflow = 'hidden';
    
    // Focus первая ссылка в мобильном меню
    const firstLink = navMobile.querySelector('.nav-mobile-link');
    if (firstLink) firstLink.focus();
  } catch (error) {
    console.error('Ошибка открытия мобильного меню:', error);
  }
}

function closeMobileMenu() {
  try {
    navMobile.classList.remove('active');
    navOverlay.classList.remove('active');
    navMobile.setAttribute('aria-hidden', 'true');
    menuToggle.setAttribute('aria-expanded', 'false');
    document.body.style.overflow = '';
    
    // Возвращаем фокус на кнопку меню
    if (menuToggle) menuToggle.focus();
  } catch (error) {
    console.error('Ошибка закрытия мобильного меню:', error);
  }
}

// Scroll Effects с debounce для производительности
function initScrollEffects() {
  let scrollTimer;
  let isScrolling = false;
  
  const debouncedScroll = debounce(() => {
    // Update reading progress
    const winScroll = document.documentElement.scrollTop;
    const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
    const scrolled = Math.min(100, (winScroll / height) * 100);
    readingProgress.style.width = scrolled + '%';
    readingProgress.setAttribute('aria-valuenow', Math.round(scrolled));
    
    // Navbar shadow
    navbar.classList.toggle('scrolled', winScroll > 40);
    
    // Анимация Timeline при скролле
    animateTimelineOnScroll();
    
    // Trigger animations for visible elements
    checkVisibleElements();
  }, 16); // ~60fps
  
  window.addEventListener('scroll', debouncedScroll, { passive: true });
}

// Функция анимации Timeline при скролле - оптимизированная версия
function animateTimelineOnScroll() {
  const timeline = document.querySelector('.timeline');
  if (!timeline) return;
  
  // Проверяем только если элемент существует и не заблокирован
  if (timeline.dataset.animating === 'true') return;
  
  const timelineRect = timeline.getBoundingClientRect();
  const windowHeight = window.innerHeight;
  
  // Проверяем, виден ли timeline
  if (timelineRect.top < windowHeight && timelineRect.bottom > 0) {
    timeline.dataset.animating = 'true';
    
    // Активируем анимацию линии
    if (!timeline.classList.contains('animate-line')) {
      timeline.classList.add('animate-line');
    }
    
    // Анимируем элементы timeline по мере скролла
    const timelineItems = timeline.querySelectorAll('.timeline-item');
    timelineItems.forEach((item, index) => {
      const itemRect = item.getBoundingClientRect();
      const itemProgress = Math.min(1, Math.max(0, (windowHeight - itemRect.top) / windowHeight));
      
      // Анимируем элемент когда он на 70% виден
      if (itemProgress > 0.3 && !item.classList.contains('animate')) {
        // Добавляем задержку для последовательного появления
        setTimeout(() => {
          item.classList.add('animate');
        }, index * 150);
      }
    });
    
    // Снимаем блокировку через небольшой таймаут
    setTimeout(() => {
      timeline.dataset.animating = 'false';
    }, 500);
  }
}

function checkVisibleElements() {
  try {
    const elements = document.querySelectorAll('[data-animate]:not(.animated)');
    const windowHeight = window.innerHeight;
    
    elements.forEach(el => {
      if (el && typeof el.getBoundingClientRect === 'function') {
        const rect = el.getBoundingClientRect();
        if (rect.top < windowHeight * 0.8 && rect.bottom > 0) {
          el.classList.add('animated');
        }
      }
    });
  } catch (error) {
    console.warn('Ошибка в checkVisibleElements:', error);
  }
}

// Content Loading с улучшенной обработкой ошибок
function loadPageContent(page) {
  try {
    switch (page) {
      case 'home':
        loadSections();
        break;
      case 'books':
        loadBooks();
        break;
      case 'book-detail':
        loadBookDetail();
        break;
      case 'audio':
        loadAudio();
        break;
      case 'encyclopedia':
        loadEncyclopedia();
        break;
      case 'world':
        loadWorld();
        break;
      case 'articles':
        loadArticles();
        break;
      case 'article-detail':
        loadArticleDetail();
        break;
      case 'reviews':
        loadReviews();
        break;
      case 'about':
        loadAbout();
        break;
      case 'character-detail':
        loadCharacterDetail();
        break;
      default:
        console.warn('Неизвестная страница:', page);
        loadSections(); // Загружаем главную по умолчанию
    }
  } catch (error) {
    console.error('Ошибка при загрузке контента страницы:', page, error);
    const mainContent = document.getElementById('main-content');
    if (mainContent) {
      const currentPageElement = mainContent.querySelector('.page.active');
      if (currentPageElement) {
        showError(currentPageElement, 'Ошибка загрузки страницы. Попробуйте обновить.');
      }
    }
  }
}

// Load Sections (Home)
function loadSections() {
  const grid = document.getElementById('sections-grid');
  if (!grid) return;
  
  try {
    showLoading(grid);
    
    setTimeout(() => {
      grid.innerHTML = data.sections.map((section, index) => `
        <div class="card" 
             style="background: linear-gradient(135deg, ${section.color1}, ${section.color2}); color: white; cursor: pointer; position: relative; overflow: hidden; animation: fadeInUp 0.6s ease ${index * 0.1}s both;" 
             data-section="${section.id}"
             role="button"
             tabindex="0"
             aria-label="Перейти к разделу ${section.title}">
          ${section.image_url ? `
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.2;">
              <img src="${section.image_url}" alt="" style="width: 100%; height: 100%; object-fit: cover;" loading="lazy">
            </div>
          ` : ''}
          <div style="position: relative; z-index: 1;">
            <div style="font-size: 48px; margin-bottom: 16px;" aria-hidden="true">${section.icon}</div>
            <h3 style="font-size: 20px; margin-bottom: 8px;">${section.title}</h3>
            <p style="opacity: 0.9;">${section.description}</p>
          </div>
        </div>
      `).join('');
      
      // Add event listeners
      grid.querySelectorAll('.card').forEach(card => {
        const sectionId = card.dataset.section;
        
        card.addEventListener('click', () => {
          if (sectionId) navigateTo(sectionId);
        });
        
        card.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            if (sectionId) navigateTo(sectionId);
          }
        });
      });
    }, 300);
    
  } catch (error) {
    console.error('Ошибка загрузки секций:', error);
    showError(grid);
  }
}

// Load Books
function loadBooks() {
  const grid = document.getElementById('books-grid');
  if (!grid) return;
  
  try {
    showLoading(grid);
    
    // Фильтруем книги по типу и жанру
    let filteredBooks = data.books;
    
    // Фильтр по типу книги
    if (currentBookType !== 'all') {
      filteredBooks = filteredBooks.filter(book => {
        if (currentBookType === 'solo') {
          return !book.coauthor || book.coauthor === 'false' || book.coauthor === false;
        } else if (currentBookType === 'coauthor') {
          return book.coauthor === 'true' || book.coauthor === true || book.coauthor === 'Анна Камская';
        }
        return true;
      });
    }
    
    // Фильтр по жанру
    if (currentFilter !== 'all') {
      filteredBooks = filteredBooks.filter(book => book.genre === currentFilter);
    }
    
    setTimeout(() => {
      grid.innerHTML = filteredBooks.map((book, index) => `
        <article class="book-card" 
                 style="animation: fadeInUp 0.6s ease ${index * 0.1}s both" 
                 role="button"
                 tabindex="0"
                 aria-label="Подробнее о книге ${book.title}"
                 data-book-id="${book.id}">
          <div class="book-cover">
            <img src="${book.image_url || book.cover_url || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'300\' height=\'400\'%3E%3Crect width=\'300\' height=\'400\' fill=\'%23FFB8D1\'/%3E%3C/svg%3E'}" 
                 alt="Обложка книги ${book.title}"
                 loading="lazy"
                 onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'300\\' height=\\'400\\'%3E%3Crect width=\\'300\\' height=\\'400\\' fill=\\'%23FFB8D1\\'/%3E%3C/svg%3E'">
          </div>
          <div class="book-info">
            <h3 class="book-title">${book.title}</h3>
            ${book.series ? `<p class="book-series">${book.series}</p>` : ''}
            ${book.coauthor && book.coauthor !== 'false' ? `<p class="book-series" style="color: var(--gold);">В соавторстве с ${book.coauthor === 'true' ? 'Анной Камской' : book.coauthor}</p>` : ''}
            <p class="book-description">${book.description}</p>
            <div class="book-meta">
              <div class="book-rating" aria-label="Рейтинг ${book.rating} из 5 звезд">
                <span aria-hidden="true">⭐</span>
                <span>${book.rating}</span>
                <span style="opacity: 0.6">(${book.reviews})</span>
              </div>
            </div>
            ${(book.litres_url || book.litnet_url || book.wildberries_url || book.labirint_url || book.ozon_url || book.rugram_url) ? `
              <div class="book-actions">
                ${book.litres_url ? `<a href="${book.litres_url}" class="store-link" target="_blank" rel="noopener" onclick="event.stopPropagation()" aria-label="Купить на ЛитРес">📚 ЛитРес</a>` : ''}
                ${book.litnet_url ? `<a href="${book.litnet_url}" class="store-link" target="_blank" rel="noopener" onclick="event.stopPropagation()" aria-label="Читать на ЛитНет">📖 ЛитНет</a>` : ''}
                ${book.wildberries_url ? `<a href="${book.wildberries_url}" class="store-link" target="_blank" rel="noopener" onclick="event.stopPropagation()" aria-label="Купить на Wildberries">🛍️ WB</a>` : ''}
                ${book.labirint_url ? `<a href="${book.labirint_url}" class="store-link" target="_blank" rel="noopener" onclick="event.stopPropagation()" aria-label="Купить в Лабиринте">📚 Лабиринт</a>` : ''}
                ${book.ozon_url ? `<a href="${book.ozon_url}" class="store-link" target="_blank" rel="noopener" onclick="event.stopPropagation()" aria-label="Купить на Ozon">🛒 Ozon</a>` : ''}
                ${book.rugram_url ? `<a href="${book.rugram_url}" class="store-link" target="_blank" rel="noopener" onclick="event.stopPropagation()" aria-label="Купить на RUGRAM">📘 RUGRAM</a>` : ''}
              </div>
            ` : ''}
          </div>
        </article>
      `).join('');
      
      // Add event listeners for book cards
      grid.querySelectorAll('.book-card').forEach(card => {
        const bookId = parseInt(card.dataset.bookId);
        
        card.addEventListener('click', () => viewBookDetail(bookId));
        card.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            viewBookDetail(bookId);
          }
        });
      });
      
    }, 300);
    
    // Добавляем обработчики для фильтров по типу книги
    document.querySelectorAll('[data-book-type]').forEach(tag => {
      tag.addEventListener('click', () => {
        document.querySelectorAll('[data-book-type]').forEach(t => {
          t.classList.remove('active');
          t.setAttribute('aria-pressed', 'false');
        });
        tag.classList.add('active');
        tag.setAttribute('aria-pressed', 'true');
        currentBookType = tag.dataset.bookType;
        loadBooks();
      });
    });
    
    // Добавляем обработчики для фильтров по жанру
    document.querySelectorAll('[data-filter]').forEach(tag => {
      tag.addEventListener('click', () => {
        document.querySelectorAll('[data-filter]').forEach(t => {
          t.classList.remove('active');
          t.setAttribute('aria-pressed', 'false');
        });
        tag.classList.add('active');
        tag.setAttribute('aria-pressed', 'true');
        currentFilter = tag.dataset.filter;
        loadBooks();
      });
    });
    
  } catch (error) {
    console.error('Ошибка загрузки книг:', error);
    showError(grid);
  }
}

// View book detail
function viewBookDetail(bookId) {
  currentBookId = bookId;
  navigateTo('book-detail');
}

// Load Book Detail
function loadBookDetail() {
  const container = document.getElementById('book-detail-content');
  if (!container || !currentBookId) return;
  
  try {
    showLoading(container);
    
    const book = data.books.find(b => b.id === currentBookId);
    if (!book) {
      showError(container, 'Книга не найдена');
      return;
    }
    
    // Get characters for this book
    const bookCharacters = book.character_ids 
      ? data.characters.filter(char => book.character_ids.includes(char.id))
      : [];
    
    setTimeout(() => {
      container.innerHTML = `
        <a href="#books" class="back-btn" data-page="books" aria-label="Вернуться к списку книг">
          ← Вернуться к книгам
        </a>
        
        <div style="display: grid; grid-template-columns: 300px 1fr; gap: 40px; margin-bottom: 40px;">
          <div>
            <div class="book-cover" style="width: 100%; border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow-lg);">
              <img src="${book.image_url || book.cover_url || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'300\' height=\'400\'%3E%3Crect width=\'300\' height=\'400\' fill=\'%23FFB8D1\'/%3E%3C/svg%3E'}" 
                   alt="Обложка книги ${book.title}"
                   style="width: 100%; height: auto;">
            </div>
            ${(book.litres_url || book.ozon_url || book.amazon_url || book.other_url) ? `
              <div style="margin-top: 20px;">
                <h3 style="font-size: 18px; margin-bottom: 12px;">Где купить:</h3>
                <div class="book-actions" style="flex-direction: column;">
                  ${book.litres_url ? `<a href="${book.litres_url}" class="btn btn-small" style="width: 100%;" target="_blank" rel="noopener">📚 ЛитРес</a>` : ''}
                  ${book.ozon_url ? `<a href="${book.ozon_url}" class="btn btn-small" style="width: 100%; background: #005BFF;" target="_blank" rel="noopener">🛒 Ozon</a>` : ''}
                  ${book.amazon_url ? `<a href="${book.amazon_url}" class="btn btn-small" style="width: 100%; background: #FF9900;" target="_blank" rel="noopener">📦 Amazon</a>` : ''}
                  ${book.other_url ? `<a href="${book.other_url}" class="btn btn-small" style="width: 100%; background: #6B7280;" target="_blank" rel="noopener">🔗 Другой магазин</a>` : ''}
                </div>
              </div>
            ` : ''}
          </div>
          
          <div>
            <h1 style="font-size: 36px; margin-bottom: 20px;">${book.title}</h1>
            ${book.series ? `<p style="font-size: 18px; color: var(--rose); margin-bottom: 10px;">${book.series}</p>` : ''}
            ${book.coauthor && book.coauthor !== 'false' ? `<p style="font-size: 16px; color: var(--gold); margin-bottom: 20px;">В соавторстве с ${book.coauthor === 'true' ? 'Анной Камской' : book.coauthor}</p>` : ''}
            
            <div class="book-meta" style="margin-bottom: 30px;">
              <div class="book-rating" style="font-size: 18px;" aria-label="Рейтинг ${book.rating} из 5 звезд">
                <span aria-hidden="true">⭐</span>
                <span>${book.rating}</span>
                <span style="opacity: 0.6">(${book.reviews} отзывов)</span>
              </div>
            </div>
            
            <p style="font-size: 18px; line-height: 1.8; margin-bottom: 20px;">${book.description}</p>
            
            ${book.full_description ? `
              <div style="margin-top: 30px;">
                <h3 style="font-size: 24px; margin-bottom: 16px;">Подробное описание</h3>
                <div style="font-size: 16px; line-height: 1.8; color: var(--cocoa); opacity: 0.9;">
                  ${book.full_description.split('\n').map(p => `<p style="margin-bottom: 16px;">${p}</p>`).join('')}
                </div>
              </div>
            ` : ''}
          </div>
        </div>
        
        ${bookCharacters.length > 0 ? `
          <section aria-labelledby="characters-heading">
            <h2 id="characters-heading" style="font-size: 28px; margin-bottom: 30px;">Персонажи</h2>
            <div class="grid grid-cols-3" style="gap: 30px;">
              ${bookCharacters.map(char => `
                <article class="character-card" 
                         style="cursor: pointer;" 
                         role="button"
                         tabindex="0"
                         aria-label="Подробнее о персонаже ${char.name}"
                         data-character-id="${char.id}">
                  <div class="character-avatar">
                    ${char.image_url ? 
                      `<img src="${char.image_url}" alt="${char.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">` : 
                      `<span aria-hidden="true">${char.emoji}</span>`
                    }
                  </div>
                  <h3 class="character-name">${char.name}</h3>
                  <p class="character-role">${char.role}</p>
                  <p class="character-description">${char.description}</p>
                </article>
              `).join('')}
            </div>
          </section>
        ` : ''}
      `;
      
      // Добавляем обработчик для кнопки возврата
      const backBtn = container.querySelector('.back-btn');
      if (backBtn) {
        backBtn.addEventListener('click', (e) => {
          e.preventDefault();
          navigateTo('books');
        });
      }
      
      // Добавляем обработчики для карточек персонажей
      container.querySelectorAll('.character-card').forEach(card => {
        const characterId = parseInt(card.dataset.characterId);
        
        card.addEventListener('click', () => viewCharacterDetail(characterId));
        card.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            viewCharacterDetail(characterId);
          }
        });
      });
      
    }, 300);
    
  } catch (error) {
    console.error('Ошибка загрузки деталей книги:', error);
    showError(container);
  }
}

// View character detail
function viewCharacterDetail(characterId) {
  currentCharacterId = characterId;
  navigateTo('character-detail');
}

// Load Character Detail
function loadCharacterDetail() {
  const container = document.getElementById('character-detail-content');
  if (!container || !currentCharacterId) return;
  
  try {
    showLoading(container);
    
    const character = data.characters.find(c => c.id === currentCharacterId);
    if (!character) {
      showError(container, 'Персонаж не найден');
      return;
    }
    
    const traitsArray = character.traits.split(',').map(t => t.trim());
    
    setTimeout(() => {
      container.innerHTML = `
        <a href="#world" class="back-btn" onclick="event.preventDefault(); currentWorldSection = 'characters'; navigateTo('world');" aria-label="Вернуться к списку персонажей">
          ← Вернуться к персонажам
        </a>
        
        <div style="text-align: center; margin-bottom: 60px;">
          <div style="width: 200px; height: 200px; background: linear-gradient(135deg, #F5E6D3, #FAF0E6); border-radius: 50%; margin: 0 auto 30px; display: flex; align-items: center; justify-content: center; font-size: 80px; overflow: hidden;">
            ${character.image_url ? 
              `<img src="${character.image_url}" alt="${character.name}" style="width: 100%; height: 100%; object-fit: cover;">` : 
              `<span aria-hidden="true">${character.emoji}</span>`
            }
          </div>
          <h1 style="font-size: 36px; margin-bottom: 10px;">${character.name}</h1>
          <p style="font-size: 20px; color: var(--rose); margin-bottom: 10px;">${character.role}</p>
          <p style="font-size: 16px; color: var(--cocoa); opacity: 0.6;">${character.age} • ${character.origin}</p>
        </div>
        
        ${character.motto ? `
          <div class="card" style="text-align: center; margin-bottom: 40px;">
            <p style="font-family: var(--font-script); font-size: 28px;">«${character.motto}»</p>
          </div>
        ` : ''}
        
        <div class="grid grid-cols-2" style="gap: 30px; margin-bottom: 40px;">
          <div class="card">
            <h3 style="font-size: 22px; margin-bottom: 20px;">Внешность</h3>
            <p style="font-size: 15px; line-height: 1.8;">${character.appearance}</p>
          </div>
          
          <div class="card">
            <h3 style="font-size: 22px; margin-bottom: 20px;">Стиль</h3>
            <p style="font-size: 15px; line-height: 1.8;">${character.style}</p>
          </div>
        </div>
        
        <div class="card" style="margin-bottom: 40px;">
          <h3 style="font-size: 22px; margin-bottom: 20px;">Манеры</h3>
          <p style="font-size: 15px; line-height: 1.8;">${character.manners}</p>
        </div>
        
        <div class="card">
          <h3 style="font-size: 22px; margin-bottom: 20px;">Характер</h3>
          <div style="margin-bottom: 20px;">
            <p style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">Основные черты:</p>
            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
              ${traitsArray.map(trait => `<span class="tag-pill active">${trait}</span>`).join('')}
            </div>
          </div>
          <p style="font-size: 15px; line-height: 1.8; margin-bottom: 12px;"><strong>Ценности:</strong> ${character.values}</p>
          <p style="font-size: 15px; line-height: 1.8; margin-bottom: 12px;"><strong>Слабости:</strong> ${character.weaknesses}</p>
          ${character.superpower ? `<p style="font-size: 15px; line-height: 1.8;"><strong>Суперсила:</strong> ${character.superpower}</p>` : ''}
        </div>
      `;
      
      // Запускаем анимации timeline с задержкой
      setTimeout(() => {
        animateTimelineOnScroll();
      }, 300);
    }, 300);
    
  } catch (error) {
    console.error('Ошибка загрузки деталей персонажа:', error);
    showError(container);
  }
}

// Load Audio
function loadAudio() {
  setTimeout(() => {
    initPageButtons();
    showAudioSection(currentAudioSection);
  }, 0);
}

function initPageButtons() {
  try {
    const audiobooksBtn = document.getElementById('audiobooks-btn');
    const podcastsBtn = document.getElementById('podcasts-btn');
    
    if (audiobooksBtn) {
      audiobooksBtn.addEventListener('click', () => showAudioSection('audiobooks'));
    }
    if (podcastsBtn) {
      podcastsBtn.addEventListener('click', () => showAudioSection('podcasts'));
    }
    
    const charactersBtn = document.getElementById('characters-btn');
    const quizBtn = document.getElementById('quiz-btn');
    const mapBtn = document.getElementById('map-btn');
    
    if (charactersBtn) {
      charactersBtn.addEventListener('click', () => showWorldSection('characters'));
    }
    if (quizBtn) {
      quizBtn.addEventListener('click', () => showWorldSection('quiz'));
    }
    if (mapBtn) {
      mapBtn.addEventListener('click', () => showWorldSection('map'));
    }
  } catch (error) {
    console.error('Ошибка инициализации кнопок страницы:', error);
  }
}

function showAudioSection(section) {
  try {
    currentAudioSection = section;
    const content = document.getElementById('audio-content');
    if (!content) return;
    
    showLoading(content);
    
    const audiobooksBtn = document.getElementById('audiobooks-btn');
    const podcastsBtn = document.getElementById('podcasts-btn');
    
    if (audiobooksBtn && podcastsBtn) {
      if (section === 'audiobooks') {
        audiobooksBtn.classList.remove('btn-outline');
        podcastsBtn.classList.add('btn-outline');
      } else {
        audiobooksBtn.classList.add('btn-outline');
        podcastsBtn.classList.remove('btn-outline');
      }
    }
    
    setTimeout(() => {
      if (section === 'audiobooks') {
        const audiobooksWithDetails = data.audiobooks.map(audiobook => {
          const book = data.books.find(b => b.id === audiobook.book_id);
          return { ...audiobook, book };
        }).filter(ab => ab.book);
        
        content.innerHTML = `
          <div style="max-width: 900px; margin: 0 auto;">
            <div style="display: grid; gap: 20px;">
              ${audiobooksWithDetails.map((audiobook, index) => `
                <div class="audio-player" 
                     style="animation: slideInRight ${0.4 + index * 0.1}s ease both;"
                     role="region"
                     aria-label="Аудиокнига ${audiobook.book.title}">
                  <div class="audio-cover" aria-hidden="true"></div>
                  <div class="audio-info">
                    <h3 class="audio-title">${audiobook.book.title}</h3>
                    <p class="audio-author">Читает: ${audiobook.narrator}</p>
                    <div class="audio-progress" role="progressbar" aria-valuenow="${audiobook.progress_demo}" aria-valuemin="0" aria-valuemax="100" aria-label="Прогресс прослушивания">
                      <div class="audio-progress-bar" style="width: ${audiobook.progress_demo}%"></div>
                    </div>
                    <div class="audio-time">
                      <span>${audiobook.progress_demo > 0 ? '3:45' : '0:00'}</span>
                      <span>${audiobook.duration}</span>
                    </div>
                  </div>
                  <button class="play-btn" aria-label="Воспроизвести аудиокнигу ${audiobook.book.title}">▶️</button>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      } else {
        content.innerHTML = `
          <div style="max-width: 900px; margin: 0 auto;">
            <div class="card" style="text-align: center; margin-bottom: 40px;">
              <div style="width: 150px; height: 150px; background: linear-gradient(135deg, #E8B4B8, #F5D0D2); border-radius: 30px; margin: 0 auto 40px; display: flex; align-items: center; justify-content: center; font-size: 60px; color: white;" aria-hidden="true">🎙️</div>
              <h2 style="font-size: 28px; margin-bottom: 20px;">Подкаст "Между строк"</h2>
              <p style="font-size: 18px; opacity: 0.8; margin-bottom: 30px;">Слушайте честные разговоры о творчестве, писательстве и литературе. Делюсь опытом, провожу интервью и рассказываю о закулисье книжного мира.</p>
            </div>
            <div style="display: grid; gap: 20px;">
              ${data.podcasts.map((podcast, i) => `
                <div class="audio-player" 
                     style="cursor: pointer; animation: slideInRight ${0.3 + i * 0.1}s ease both;"
                     role="button"
                     tabindex="0"
                     aria-label="Воспроизвести подкаст: ${podcast.title}">
                  <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #E8B4B8, #F5D0D2); border-radius: 16px; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;" aria-hidden="true">🎙️</div>
                  <div class="audio-info">
                    <h4 style="font-size: 18px; margin-bottom: 5px;">Выпуск #${podcast.episode}: ${podcast.title}</h4>
                    <p style="opacity: 0.8; font-size: 14px; margin-bottom: 4px;">${podcast.description}</p>
                    <p style="opacity: 0.6; font-size: 14px;">${podcast.duration} минут • ${new Date(podcast.date).toLocaleDateString('ru-RU')}</p>
                  </div>
                  <button class="play-btn" style="width: 40px; height: 40px; font-size: 16px;" aria-label="Воспроизвести выпуск ${podcast.episode}">▶️</button>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }
      
      content.querySelectorAll('.play-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          togglePlay(btn);
        });
      });
    }, 300);
    
  } catch (error) {
    console.error('Ошибка загрузки аудио секции:', error);
    showError(document.getElementById('audio-content'));
  }
}

// Load World
function loadWorld() {
  setTimeout(() => {
    initPageButtons();
    showWorldSection(currentWorldSection);
  }, 0);
}

function showWorldSection(section) {
  try {
    currentWorldSection = section;
    const content = document.getElementById('world-content');
    if (!content) return;
    
    showLoading(content);
    
    const charactersBtn = document.getElementById('characters-btn');
    const quizBtn = document.getElementById('quiz-btn');
    const mapBtn = document.getElementById('map-btn');
    
    if (charactersBtn && quizBtn && mapBtn) {
      charactersBtn.classList.toggle('btn-outline', section !== 'characters');
      quizBtn.classList.toggle('btn-outline', section !== 'quiz');
      mapBtn.classList.toggle('btn-outline', section !== 'map');
    }
    
    setTimeout(() => {
      switch (section) {
        case 'characters':
          content.innerHTML = `
            <div class="grid grid-cols-3" style="gap: 30px;">
              ${data.characters.map((char, index) => `
                <article class="character-card" 
                         style="animation: fadeInUp 0.6s ease ${index * 0.1}s both; cursor: pointer;" 
                         role="button"
                         tabindex="0"
                         aria-label="Подробнее о персонаже ${char.name}"
                         data-character-id="${char.id}">
                  <div class="character-avatar">
                    ${char.image_url ? 
                      `<img src="${char.image_url}" alt="${char.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">` : 
                      `<span aria-hidden="true">${char.emoji}</span>`
                    }
                  </div>
                  <h3 class="character-name">${char.name}</h3>
                  <p class="character-role">${char.role}</p>
                  <p class="character-description">${char.description}</p>
                  <div style="margin-bottom: 16px;">
                    <p style="font-size: 14px; opacity: 0.6;"><strong>Возраст:</strong> ${char.age}</p>
                  </div>
                  <div class="character-skills">
                    ${char.skills.map(skill => `<span class="tag-pill">${skill}</span>`).join('')}
                  </div>
                  <button class="btn btn-small" style="margin-top: 16px; width: 100%;">Подробнее →</button>
                </article>
              `).join('')}
            </div>
          `;
          
          // Добавляем обработчики событий для персонажей
          content.querySelectorAll('.character-card').forEach(card => {
            const characterId = parseInt(card.dataset.characterId);
            
            card.addEventListener('click', () => viewCharacterDetail(characterId));
            card.addEventListener('keydown', (e) => {
              if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                viewCharacterDetail(characterId);
              }
            });
          });
          break;
          
        case 'quiz':
          content.innerHTML = `
            <div class="quiz-card" role="region" aria-labelledby="quiz-title">
              <div class="quiz-header">
                <span style="opacity: 0.6;">Вопрос ${quizProgress + 1} из 5</span>
                <span style="font-weight: 600; color: var(--rose);">Счёт: 0</span>
              </div>
              <div class="quiz-progress" role="progressbar" aria-valuenow="${(quizProgress + 1) * 20}" aria-valuemin="0" aria-valuemax="100" aria-label="Прогресс квиза">
                <div class="quiz-progress-bar" style="width: ${(quizProgress + 1) * 20}%"></div>
              </div>
              <h3 id="quiz-title" class="quiz-question">Где произошли события с иконой Черной Мадонны?</h3>
              <div class="quiz-options" role="radiogroup" aria-labelledby="quiz-title">
                ${['Франция', 'Италия', 'Испания', 'Греция'].map((option, i) => `
                  <button class="quiz-option" 
                          role="radio" 
                          aria-checked="false"
                          data-option-index="${i}"
                          tabindex="${i === 0 ? '0' : '-1'}">${option}</button>
                `).join('')}
              </div>
            </div>
          `;
          
          // Добавляем обработчики для квиза
          content.querySelectorAll('.quiz-option').forEach((option, index) => {
            option.addEventListener('click', () => {
              selectQuizOption(option, index === 1);
            });
            
            option.addEventListener('keydown', (e) => {
              if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                selectQuizOption(option, index === 1);
              }
            });
          });
          break;
          
        case 'map':
          content.innerHTML = `
            <div class="map-container">
              <div class="map-bg"></div>
              <div class="map-content">
                <div class="map-header">
                  <h2 style="font-size: 32px; margin-bottom: 20px;">Долина Инферин</h2>
                  <p style="font-size: 18px; opacity: 0.8;">Интерактивная карта фэнтезийного мира</p>
                </div>
                <div class="map-viewport">
                  <button class="map-location map-location-1" 
                          data-location="Столица"
                          aria-label="Столица Долины Инферин"
                          style="position: absolute; top: 20%; left: 30%;">
                    <span style="font-size: 24px;" aria-hidden="true">🏰</span>
                  </button>
                  <button class="map-location map-location-2" 
                          data-location="Лес теней"
                          aria-label="Лес теней"
                          style="position: absolute; top: 50%; right: 25%;">
                    <span style="font-size: 20px;" aria-hidden="true">🌲</span>
                  </button>
                  <button class="map-location map-location-3" 
                          data-location="Озеро магии"
                          aria-label="Озеро магии"
                          style="position: absolute; bottom: 20%; left: 40%;">
                    <span style="font-size: 22px;" aria-hidden="true">💎</span>
                  </button>
                  <p style="opacity: 0.6; font-style: italic; position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);">Нажмите на локации для получения информации</p>
                </div>
                <div class="location-info" id="location-info" aria-live="polite">
                  <h3 class="location-title" id="location-title"></h3>
                  <p class="location-description" id="location-description"></p>
                </div>
              </div>
            </div>
          `;
          
          // Добавляем обработчики для карты
          content.querySelectorAll('.map-location').forEach(location => {
            const name = location.dataset.location;
            
            location.addEventListener('click', () => showLocation(name));
            location.addEventListener('keydown', (e) => {
              if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                showLocation(name);
              }
            });
          });
          break;
      }
    }, 300);
    
  } catch (error) {
    console.error('Ошибка загрузки мира:', error);
    showError(content);
  }
}

// Interactive Functions
function togglePlay(button) {
  try {
    const isPlaying = button.classList.contains('playing');
    button.classList.toggle('playing');
    button.textContent = isPlaying ? '▶️' : '⏸️';
    button.setAttribute('aria-label', isPlaying ? 'Воспроизвести' : 'Приостановить');
  } catch (error) {
    console.error('Ошибка переключения воспроизведения:', error);
  }
}

function selectQuizOption(option, isCorrect) {
  try {
    // Обновляем aria-checked для всех опций
    document.querySelectorAll('.quiz-option').forEach(opt => {
      opt.setAttribute('aria-checked', 'false');
      opt.classList.remove('selected');
    });
    
    option.classList.add('selected');
    option.setAttribute('aria-checked', 'true');
    
    if (isCorrect) {
      setTimeout(() => {
        showToast('Правильно! 🎉', 'success');
        quizProgress = (quizProgress + 1) % 5;
        showWorldSection('quiz');
      }, 300);
    } else {
      option.style.background = '#EF4444';
      option.style.color = 'white';
      showToast('Неправильно. Попробуйте еще раз!', 'error');
      setTimeout(() => {
        option.style.background = '';
        option.style.color = '';
        option.classList.remove('selected');
        option.setAttribute('aria-checked', 'false');
      }, 1000);
    }
  } catch (error) {
    console.error('Ошибка выбора опции квиза:', error);
  }
}

function showLocation(name) {
  try {
    const info = document.getElementById('location-info');
    const title = document.getElementById('location-title');
    const description = document.getElementById('location-description');
    
    const locations = {
      'Столица': 'Великий город Инферин — сердце королевства, где магия и технологии существуют в гармонии.',
      'Лес теней': 'Таинственный лес, населенный древними существами и хранящий секреты прошлого.',
      'Озеро магии': 'Священное озеро, воды которого обладают целительной силой и могут исполнять желания.'
    };
    
    if (info && title && description) {
      title.textContent = name;
      description.textContent = locations[name];
      info.classList.add('active');
    }
  } catch (error) {
    console.error('Ошибка показа локации:', error);
  }
}

// Load Articles
function loadArticles() {
  const content = document.getElementById('articles-content');
  if (!content) return;
  
  try {
    showLoading(content);
    
    // Используем полные статьи если есть, иначе обычные
    const articles = data.articles_full?.length > 0 ? data.articles_full : data.articles;
    
    setTimeout(() => {
      content.innerHTML = `
        <div style="margin-bottom: 40px;">
          <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-bottom: 30px;" role="group" aria-label="Фильтры статей">
            <button class="tag-pill active" aria-pressed="true">Все статьи</button>
            <button class="tag-pill" aria-pressed="false">Писательство</button>
            <button class="tag-pill" aria-pressed="false">Творчество</button>
            <button class="tag-pill" aria-pressed="false">Процесс</button>
            <button class="tag-pill" aria-pressed="false">Мир книг</button>
          </div>
        </div>
        
        <div class="grid grid-cols-1" style="gap: 30px; max-width: 800px; margin: 0 auto;">
          ${articles.map((article, index) => `
            <article class="article-card" 
                     style="animation: fadeInUp ${0.4 + index * 0.1}s ease both;" 
                     role="button"
                     tabindex="0"
                     aria-label="Читать статью: ${article.title}"
                     data-article-slug="${article.slug || article.id || index}">
              ${article.cover_url ? `
                <div class="article-cover">
                  <img src="${article.cover_url}" alt="" loading="lazy">
                </div>
              ` : ''}
              <div class="article-info">
                <div class="article-meta">
                  ${article.category ? `<span class="article-category">${article.category}</span>` : ''}
                  <span>•</span>
                  <span>${new Date(article.date).toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' })}</span>
                  <span>•</span>
                  <span>${article.read_time} мин чтения</span>
                </div>
                <h3 class="article-title">${article.title}</h3>
                <p class="article-excerpt">${article.excerpt}</p>
                <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 20px;">
                  <div style="display: flex; gap: 16px;">
                    ${article.views ? `<span style="display: flex; align-items: center; gap: 6px; font-size: 14px; color: var(--cocoa); opacity: 0.6;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg> ${article.views}</span>` : ''}
                    ${article.likes ? `<span style="display: flex; align-items: center; gap: 6px; font-size: 14px; color: var(--cocoa); opacity: 0.6;"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg> ${article.likes}</span>` : ''}
                  </div>
                  <span style="color: var(--rose); font-weight: 600; font-size: 14px;">Читать →</span>
                </div>
              </div>
            </article>
          `).join('')}
        </div>
      `;
      
      // Добавляем обработчики для фильтров
      content.querySelectorAll('.tag-pill').forEach(tag => {
        tag.addEventListener('click', () => {
          content.querySelectorAll('.tag-pill').forEach(t => {
            t.classList.remove('active');
            t.setAttribute('aria-pressed', 'false');
          });
          tag.classList.add('active');
          tag.setAttribute('aria-pressed', 'true');
        });
      });
      
      // Добавляем обработчики для статей
      content.querySelectorAll('.article-card').forEach(card => {
        const slug = card.dataset.articleSlug;
        
        card.addEventListener('click', () => openArticle(slug));
        card.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            openArticle(slug);
          }
        });
      });
      
    }, 300);
    
  } catch (error) {
    console.error('Ошибка загрузки статей:', error);
    showError(content);
  }
}

// Функция открытия статьи
function openArticle(slug) {
  currentArticleSlug = slug;
  navigateTo('article-detail');
}

// Загрузка детальной страницы статьи
function loadArticleDetail() {
  const content = document.getElementById('article-detail-content');
  if (!content || !currentArticleSlug) return;
  
  try {
    showLoading(content);
    
    // Ищем статью
    let article = null;
    if (data.articles_full?.length > 0) {
      article = data.articles_full.find(a => 
        a.slug === currentArticleSlug || 
        a.id == currentArticleSlug || 
        data.articles_full.indexOf(a) == currentArticleSlug
      );
    }
    
    // Если не нашли в полных статьях, ищем в обычных
    if (!article && data.articles?.length > 0) {
      article = data.articles.find(a => 
        a.id == currentArticleSlug || 
        data.articles.indexOf(a) == currentArticleSlug
      );
    }
    
    if (!article) {
      showError(content, 'Статья не найдена');
      return;
    }
    
    setTimeout(() => {
      // Отображаем статью
      content.innerHTML = `
        <div class="article-detail">
          <a href="#articles" class="back-btn" aria-label="Вернуться к списку статей">
            ← Вернуться к статьям
          </a>
          
          <article>
            <header class="article-detail-header">
              ${article.category ? `<div class="article-detail-category">${article.category}</div>` : ''}
              <h1 class="article-detail-title">${article.title}</h1>
              <div class="article-detail-meta">
                <div class="article-detail-meta-item">
                  <div class="author-avatar">
                    ${data.settings && data.settings.author_photo_url ? 
                      `<img src="${data.settings.author_photo_url}" alt="${article.author || 'Екатерина Новак'}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">` : 
                      'ЕН'
                    }
                  </div>
                  <span>${article.author || 'Екатерина Новак'}</span>
                </div>
                <div class="article-detail-meta-item">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                  <span>${new Date(article.date).toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' })}</span>
                </div>
                <div class="article-detail-meta-item">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  </svg>
                  <span>${article.read_time} мин чтения</span>
                </div>
              </div>
            </header>
            
            ${article.cover_url ? `
              <div style="margin-bottom: var(--space-3xl); border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow-md);">
                <img src="${article.cover_url}" alt="" style="width: 100%; height: auto;" loading="lazy">
              </div>
            ` : ''}
            
            <div class="article-content">
              ${article.content ? parseMarkdown(article.content) : `
                <p>${article.excerpt}</p>
                <p style="text-align: center; opacity: 0.6; margin-top: 40px;">
                  <em>Полный текст статьи скоро будет доступен...</em>
                </p>
              `}
            </div>
            
            ${article.tags ? `
              <div style="margin-top: var(--space-2xl); padding-top: var(--space-xl); border-top: 1px solid var(--blush);">
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                  ${article.tags.split(',').map(tag => `<span class="tag-pill">${tag.trim()}</span>`).join('')}
                </div>
              </div>
            ` : ''}
          </article>
        </div>
      `;
      
      // Добавляем обработчик для кнопки возврата
      const backBtn = content.querySelector('.back-btn');
      if (backBtn) {
        backBtn.addEventListener('click', (e) => {
          e.preventDefault();
          navigateTo('articles');
        });
      }
      
    }, 300);
    
  } catch (error) {
    console.error('Ошибка загрузки деталей статьи:', error);
    showError(content);
  }
}

// Load Reviews
function loadReviews() {
  const content = document.getElementById('reviews-content');
  if (!content) return;
  
  try {
    showLoading(content);
    
    setTimeout(() => {
      content.innerHTML = data.reviews.map((review, index) => `
        <article class="card" 
                 style="animation: fadeInUp 0.6s ease ${index * 0.1}s both" 
                 data-animate>
          <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 24px;">
            <div style="width: 80px; height: 80px; border-radius: 50%; background: ${review.avatar_url ? 'transparent' : `linear-gradient(135deg, ${review.avatar_color1}, ${review.avatar_color2})`}; flex-shrink: 0; animation: float 3s ease-in-out infinite; animation-delay: ${index * 0.3}s; overflow: hidden;">
              ${review.avatar_url ? 
                `<img src="${review.avatar_url}" alt="${review.author}" style="width: 100%; height: 100%; object-fit: cover;">` : 
                ''
              }
            </div>
            <div>
              <h3 style="font-size: 20px; margin-bottom: 4px;">${review.author}</h3>
              <p style="font-size: 14px; opacity: 0.6;">${review.handle}</p>
              <div style="color: #FFA500; font-size: 14px; margin-top: 4px;" aria-label="Рейтинг ${review.rating} из 5 звезд">${'⭐'.repeat(review.rating)}</div>
            </div>
          </div>
          <blockquote style="font-size: 16px; line-height: 1.8; font-style: italic; position: relative; padding-left: 30px; margin-bottom: 20px;">
            <span style="position: absolute; left: 0; top: -10px; font-size: 50px; color: var(--rose); opacity: 0.3;" aria-hidden="true">"</span>
            ${review.text}
          </blockquote>
          <div style="display: flex; gap: 16px; margin-top: 20px;">
            <span class="meta-pill">👍 ${review.likes}</span>
            <span class="meta-pill">💬 ${review.comments}</span>
            ${review.link ? `<a href="${review.link}" target="_blank" rel="noopener" class="meta-pill" style="text-decoration: none;">🔗 Читать полностью</a>` : '<span class="meta-pill">🔗 Поделиться</span>'}
          </div>
        </article>
      `).join('');
      
      setTimeout(() => checkVisibleElements(), 100);
    }, 300);
    
  } catch (error) {
    console.error('Ошибка загрузки отзывов:', error);
    showError(content);
  }
}

// Load About
function loadAbout() {
  const content = document.getElementById('about-content');
  if (!content) return;
  
  try {
    showLoading(content);
    
    setTimeout(() => {
      content.innerHTML = `
        <div style="display: flex; align-items: center; gap: 100px; margin-bottom: 60px;">
          <!-- Левая часть с фото -->
          <div style="flex-shrink: 0; position: relative;">
            <!-- Градиентная подложка -->
            <div style="position: absolute; top: -20px; left: -20px; width: 320px; height: 320px; background: linear-gradient(135deg, var(--rose) 0%, #B983DB 25%, #FF1493 50%, #FFB8D1 75%, #B983DB 100%); border-radius: 50%; opacity: 0.3; filter: blur(40px); animation: gradient-shift 8s ease infinite;" aria-hidden="true"></div>
            
            <!-- Дополнительные декоративные круги -->
            <div style="position: absolute; top: -10px; right: -10px; width: 80px; height: 80px; background: linear-gradient(135deg, #FFB8D1, #FFCFE5); border-radius: 50%; opacity: 0.6; animation: float 3s ease-in-out infinite;" aria-hidden="true"></div>
            <div style="position: absolute; bottom: -15px; left: -15px; width: 60px; height: 60px; background: linear-gradient(135deg, #D4B5F5, #E4D5F7); border-radius: 50%; opacity: 0.5; animation: float 3s ease-in-out infinite reverse;" aria-hidden="true"></div>
            
            <!-- Основное фото -->
            <div style="width: 280px; height: 280px; background: linear-gradient(135deg, #FFCAA6, #FFE0CC); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 120px; box-shadow: var(--shadow-lg); overflow: hidden; position: relative; z-index: 1;">
              ${data.settings && data.settings.author_photo_url ? 
                `<img src="${data.settings.author_photo_url}" alt="Екатерина Новак" style="width: 100%; height: 100%; object-fit: cover;">` : 
                '<span aria-hidden="true">👩‍💼</span>'
              }
            </div>
          </div>
          
          <!-- Правая часть с текстом -->
          <div style="flex: 1; max-width: 800px;">
            <div class="card" style="padding: 35px 50px; background: var(--bg-1); border-radius: 25px; box-shadow: var(--shadow-md);">
              <div style="display: flex; flex-direction: column; gap: 20px;">
                <h1 class="gradient-text" style="font-size: 36px; margin: 0;">Привет! Я</h1>
                
                <div>
                  <p style="font-size: 18px; line-height: 1.6; margin-bottom: 10px;">Екатерина Новак — писательница, создающая миры, где детективы переплетаются с магией.</p>
                  <p style="font-size: 18px; line-height: 1.6; margin: 0;">С 2020 года я написала более 15 книг в жанрах детектива, фэнтези и современной прозы. Мои истории — это путешествия в миры, где каждая страница приносит новые открытия.</p>
                </div>
                
                <!-- Инфо блоки в ряд -->
                <div style="display: flex; gap: 30px; flex-wrap: wrap;">
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 20px;" aria-hidden="true">📍</span>
                    <span style="font-size: 16px; color: var(--cocoa);">Россия</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 20px;" aria-hidden="true">✍️</span>
                    <span style="font-size: 16px; color: var(--cocoa);">Пишу с 2020 года</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 20px;" aria-hidden="true">📚</span>
                    <span style="font-size: 16px; color: var(--cocoa);">15+ опубликованных произведений</span>
                  </div>
                </div>
                
                <!-- Кнопки -->
                <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
                  <a href="mailto:${data.settings && data.settings.email ? data.settings.email : 'contact@ekaterina-novak.ru'}" class="btn">
                    ✉️ Написать мне
                  </a>
                  <div style="display: flex; gap: 12px;">
                    <a href="${data.settings && data.settings.vk_url ? data.settings.vk_url : 'https://vk.com'}" 
                       class="social-link" 
                       style="width: 44px; height: 44px; background: var(--rose); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; text-decoration: none; transition: var(--transition-fast); box-shadow: var(--shadow-sm);" 
                       target="_blank" 
                       rel="noopener"
                       aria-label="ВКонтакте">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                        <path d="M15.684 0H8.316C1.592 0 0 1.592 0 8.316v7.368C0 22.408 1.592 24 8.316 24h7.368C22.408 24 24 22.408 24 15.684V8.316C24 1.592 22.408 0 15.684 0zm3.692 17.123h-1.744c-.66 0-.864-.525-2.05-1.727-1.033-1-1.49-1.135-1.744-1.135-.356 0-.458.102-.458.593v1.575c0 .424-.135.678-1.253.678-1.846 0-3.896-1.118-5.335-3.202C4.624 10.857 4 8.57 4 8.096c0-.254.102-.491.593-.491h1.744c.44 0 .61.203.78.677.863 2.49 2.303 4.675 2.896 4.675.22 0 .322-.102.322-.66V9.721c-.068-1.186-.695-1.287-.695-1.71 0-.204.17-.407.44-.407h2.744c.373 0 .508.203.508.643v3.473c0 .372.17.508.271.508.22 0 .407-.136.813-.542 1.27-1.422 2.18-3.61 2.18-3.61.119-.254.322-.491.762-.491h1.744c.525 0 .644.27.525.643-.22 1.017-2.354 4.031-2.354 4.031-.186.305-.254.44 0 .78.186.254.796.779 1.203 1.253.745.847 1.32 1.558 1.473 2.05.17.491-.085.745-.576.745z"/>
                      </svg>
                    </a>
                    <a href="${data.settings && data.settings.telegram_url ? data.settings.telegram_url : 'https://t.me'}" 
                       class="social-link" 
                       style="width: 44px; height: 44px; background: var(--rose); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; text-decoration: none; transition: var(--transition-fast); box-shadow: var(--shadow-sm);" 
                       target="_blank" 
                       rel="noopener"
                       aria-label="Телеграм">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                        <path d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.2-1.3l15.97-6.16c.73-.33 1.43.18 1.15 1.3l-2.72 12.81c-.19.91-.74 1.13-1.5.71L12.6 16.3l-1.99 1.93c-.23.23-.42.42-.83.42z"/>
                      </svg>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Цитата -->
        <div class="card" style="text-align: center; padding: 40px; background: var(--bg-1); margin-bottom: 60px;">
          <p class="font-quote gold" style="margin: 0;">"Писательство для меня — это способ делиться волшебством"</p>
        </div>
        
        <h3 style="font-size: 28px; margin-bottom: 30px; text-align: center;">Мой творческий путь</h3>
        <div class="timeline">
          ${[
            { date: '2020', title: 'Первая книга', description: 'Опубликована дебютная книга "Тайна старого дома"' },
            { date: '2021', title: 'Серия "Дилетантки"', description: 'Начало популярной детективной серии' },
            { date: '2022', title: 'Мир фэнтези', description: 'Создание вселенной "Долина Инферин"' },
            { date: '2023', title: 'Признание', description: 'Премия "Лучший детектив года"' },
            { date: '2024', title: 'Новые горизонты', description: 'Запуск подкаста и аудиокниг' }
          ].map((item, index) => `
            <div class="timeline-item">
              <div class="timeline-dot"></div>
              <div class="timeline-content">
                <div class="timeline-date">${item.date}</div>
                <div class="timeline-title">${item.title}</div>
                <div class="timeline-description">${item.description}</div>
              </div>
            </div>
          `).join('')}
        </div>
        
        <!-- НОВЫЙ РАЗДЕЛ "Немного обо мне" -->
        <div style="margin-top: 80px;">
          <h3 style="font-size: 28px; margin-bottom: 20px; text-align: center;">Немного обо мне</h3>
          <p style="text-align: center; font-size: 18px; opacity: 0.8; margin-bottom: 50px; max-width: 600px; margin-left: auto; margin-right: auto;">Интересные факты, которые помогают мне создавать истории</p>
          
          <div class="grid grid-cols-3" style="gap: 30px;">
            <!-- Карточка 1: Кофеманка -->
            <div class="about-me-card" style="animation: fadeInUp 0.6s ease 0.1s both;">
              <div class="about-me-icon" style="background: linear-gradient(135deg, #D2691E, #F4A460); animation-delay: 0.2s;">☕</div>
              <h4 class="about-me-title">Кофеманка</h4>
              <p class="about-me-description">Выпиваю не менее 4 чашек кофе в день. Лучшие идеи приходят именно за чашечкой ароматного эспрессо!</p>
            </div>
            
            <!-- Карточка 2: Кошатница -->
            <div class="about-me-card" style="animation: fadeInUp 0.6s ease 0.2s both;">
              <div class="about-me-icon" style="background: linear-gradient(135deg, #FF69B4, #FFB6C1); animation-delay: 0.3s;">💖</div>
              <h4 class="about-me-title">Кошатница</h4>
              <p class="about-me-description">У меня живёт рыжая кошка, которая часто "помогает" писать, ходя по клавиатуре. Иногда её лапки создают самые неожиданные сюжетные повороты!</p>
            </div>
            
            <!-- Карточка 3: Книголюб -->
            <div class="about-me-card" style="animation: fadeInUp 0.6s ease 0.3s both;">
              <div class="about-me-icon" style="background: linear-gradient(135deg, #32CD32, #98FB98); animation-delay: 0.4s;">📖</div>
              <h4 class="about-me-title">Книголюб</h4>
              <p class="about-me-description">Читаю около 100 книг в год. Особенно люблю детективы, фэнтези и классическую литературу.</p>
            </div>
            
            <!-- Карточка 4: Полуночные идеи -->
            <div class="about-me-card" style="animation: fadeInUp 0.6s ease 0.4s both;">
              <div class="about-me-icon" style="background: linear-gradient(135deg, #4B0082, #9370DB); animation-delay: 0.5s;">🌙</div>
              <h4 class="about-me-title">Ночная сова</h4>
              <p class="about-me-description">Самые продуктивные часы для написания — с 22:00 до 2:00. В тишине ночи рождаются лучшие истории.</p>
            </div>
            
            <!-- Карточка 5: Путешественница -->
            <div class="about-me-card" style="animation: fadeInUp 0.6s ease 0.5s both;">
              <div class="about-me-icon" style="background: linear-gradient(135deg, #1E90FF, #87CEEB); animation-delay: 0.6s;">✈️</div>
              <h4 class="about-me-title">Путешественница</h4>
              <p class="about-me-description">Каждое путешествие дарит новые идеи для книг. Особенно вдохновляют старинные замки и таинственные города.</p>
            </div>
            
            <!-- Карточка 6: Коллекционер впечатлений -->
            <div class="about-me-card" style="animation: fadeInUp 0.6s ease 0.6s both;">
              <div class="about-me-icon" style="background: linear-gradient(135deg, #FF6347, #FFA07A); animation-delay: 0.7s;">🎭</div>
              <h4 class="about-me-title">Театралка</h4>
              <p class="about-me-description">Регулярно хожу в театр и на выставки. Искусство помогает лучше понимать человеческие эмоции и создавать живых персонажей.</p>
            </div>
          </div>
        </div>
        
        <!-- НОВЫЙ РАЗДЕЛ "Давайте дружить!" -->
        <div style="margin-top: 80px; text-align: center; padding: 60px 40px; background: var(--bg-1); border-radius: 30px; box-shadow: var(--shadow-lg);">
          <h3 style="font-size: 32px; margin-bottom: 20px; color: var(--cocoa);">Давайте дружить!</h3>
          <p style="font-size: 18px; opacity: 0.8; margin-bottom: 40px; max-width: 600px; margin-left: auto; margin-right: auto; line-height: 1.6;">
            Подписывайтесь на мои социальные сети, чтобы быть в курсе новых произведений, участвовать в обсуждениях и получать эксклюзивный контент.
          </p>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; max-width: 800px; margin: 0 auto;">
            <!-- ВКонтакте -->
            <a href="${data.settings && data.settings.vk_url ? data.settings.vk_url : 'https://vk.com'}" 
               target="_blank" 
               rel="noopener"
               class="social-link"
               style="display: flex; flex-direction: column; align-items: center; gap: 12px; padding: 24px 20px; background: linear-gradient(135deg, #4C75A3, #5B87C7); color: white; text-decoration: none; border-radius: 16px; transition: var(--transition-base); box-shadow: var(--shadow-sm); min-height: 120px;"
               aria-label="Подписаться ВКонтакте">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M15.684 0H8.316C1.592 0 0 1.592 0 8.316v7.368C0 22.408 1.592 24 8.316 24h7.368C22.408 24 24 22.408 24 15.684V8.316C24 1.592 22.408 0 15.684 0zm3.692 17.123h-1.744c-.66 0-.864-.525-2.05-1.727-1.033-1-1.49-1.135-1.744-1.135-.356 0-.458.102-.458.593v1.575c0 .424-.135.678-1.253.678-1.846 0-3.896-1.118-5.335-3.202C4.624 10.857 4 8.57 4 8.096c0-.254.102-.491.593-.491h1.744c.44 0 .61.203.78.677.863 2.49 2.303 4.675 2.896 4.675.22 0 .322-.102.322-.66V9.721c-.068-1.186-.695-1.287-.695-1.71 0-.204.17-.407.44-.407h2.744c.373 0 .508.203.508.643v3.473c0 .372.17.508.271.508.22 0 .407-.136.813-.542 1.27-1.422 2.18-3.61 2.18-3.61.119-.254.322-.491.762-.491h1.744c.525 0 .644.27.525.643-.22 1.017-2.354 4.031-2.354 4.031-.186.305-.254.44 0 .78.186.254.796.779 1.203 1.253.745.847 1.32 1.558 1.473 2.05.17.491-.085.745-.576.745z"/>
              </svg>
              <span style="font-weight: 600; font-size: 16px;">ВКонтакте</span>
            </a>
            
            <!-- Телеграм -->
            <a href="${data.settings && data.settings.telegram_url ? data.settings.telegram_url : 'https://t.me'}" 
               target="_blank" 
               rel="noopener"
               class="social-link"
               style="display: flex; flex-direction: column; align-items: center; gap: 12px; padding: 24px 20px; background: linear-gradient(135deg, #0088CC, #00A3E0); color: white; text-decoration: none; border-radius: 16px; transition: var(--transition-base); box-shadow: var(--shadow-sm); min-height: 120px;"
               aria-label="Подписаться в Телеграм">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.2-1.3l15.97-6.16c.73-.33 1.43.18 1.15 1.3l-2.72 12.81c-.19.91-.74 1.13-1.5.71L12.6 16.3l-1.99 1.93c-.23.23-.42.42-.83.42z"/>
              </svg>
              <span style="font-weight: 600; font-size: 16px;">Телеграм</span>
            </a>
            
            <!-- Email -->
            <a href="mailto:${data.settings && data.settings.email ? data.settings.email : 'contact@ekaterina-novak.ru'}" 
               class="social-link"
               style="display: flex; flex-direction: column; align-items: center; gap: 12px; padding: 24px 20px; background: linear-gradient(135deg, #EA4335, #FBBC04); color: white; text-decoration: none; border-radius: 16px; transition: var(--transition-base); box-shadow: var(--shadow-sm); min-height: 120px;"
               aria-label="Написать письмо">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
              </svg>
              <span style="font-weight: 600; font-size: 16px;">Написать</span>
            </a>
            
            <!-- Яппи -->
            <a href="${data.settings && data.settings.yappy_url ? data.settings.yappy_url : 'https://yappy.media'}" 
               target="_blank" 
               rel="noopener"
               class="social-link"
               style="display: flex; flex-direction: column; align-items: center; gap: 12px; padding: 24px 20px; background: linear-gradient(135deg, #FF6B6B, #FF8E8E); color: white; text-decoration: none; border-radius: 16px; transition: var(--transition-base); box-shadow: var(--shadow-sm); min-height: 120px;"
               aria-label="Подписаться на Яппи">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
              <span style="font-weight: 600; font-size: 16px;">Яппи</span>
            </a>
            
            <!-- Дзен -->
            <a href="${data.settings && data.settings.dzen_url ? data.settings.dzen_url : 'https://dzen.ru'}" 
               target="_blank" 
               rel="noopener"
               class="social-link"
               style="display: flex; flex-direction: column; align-items: center; gap: 12px; padding: 24px 20px; background: linear-gradient(135deg, #FC5B2A, #FF7A47); color: white; text-decoration: none; border-radius: 16px; transition: var(--transition-base); box-shadow: var(--shadow-sm); min-height: 120px;"
               aria-label="Подписаться на Дзен">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M12 0C5.372 0 0 5.372 0 12s5.372 12 12 12 12-5.372 12-12S18.628 0 12 0zm0 2c5.514 0 10 4.486 10 10s-4.486 10-10 10S2 17.514 2 12 6.486 2 12 2zm0 3.5c-3.59 0-6.5 2.91-6.5 6.5s2.91 6.5 6.5 6.5 6.5-2.91 6.5-6.5-2.91-6.5-6.5-6.5z"/>
              </svg>
              <span style="font-weight: 600; font-size: 16px;">Дзен</span>
            </a>
            
            <!-- ТикТок -->
            <a href="${data.settings && data.settings.tiktok_url ? data.settings.tiktok_url : 'https://tiktok.com'}" 
               target="_blank" 
               rel="noopener"
               class="social-link"
               style="display: flex; flex-direction: column; align-items: center; gap: 12px; padding: 24px 20px; background: linear-gradient(135deg, #000000, #333333); color: white; text-decoration: none; border-radius: 16px; transition: var(--transition-base); box-shadow: var(--shadow-sm); min-height: 120px;"
               aria-label="Подписаться на ТикТок">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
              </svg>
              <span style="font-weight: 600; font-size: 16px;">ТикТок</span>
            </a>
          </div>
        </div>
      `;
    }, 300);
    
  } catch (error) {
    console.error('Ошибка загрузки страницы "О себе":', error);
    showError(content);
  }
}

// Load Encyclopedia
function loadEncyclopedia() {
  const nav = document.querySelector('.encyclopedia-nav');
  const content = document.getElementById('encyclopedia-content');
  if (!nav || !content) return;
  
  try {
    showLoading(content);
    
    const books = ['Дилетантки', 'Долина Инферин', 'Сердце Велисгара', 'Самая красивая', 'Ветер в сердце'];
    
    nav.innerHTML = books.map((book, i) => `
      <button class="tag-pill ${i === 0 ? 'active' : ''}" 
              data-book-index="${i}"
              aria-pressed="${i === 0 ? 'true' : 'false'}">${book}</button>
    `).join('');
    
    // Add event listeners
    setTimeout(() => {
      nav.querySelectorAll('.tag-pill').forEach(btn => {
        btn.addEventListener('click', () => {
          const index = parseInt(btn.dataset.bookIndex);
          showEncyclopediaSection(index);
        });
      });
    }, 0);
    
    showEncyclopediaSection(0);
    
  } catch (error) {
    console.error('Ошибка загрузки энциклопедии:', error);
    showError(content);
  }
}

function showEncyclopediaSection(index) {
  const content = document.getElementById('encyclopedia-content');
  if (!content) return;
  
  try {
    const sections = [
      {
        title: 'Дилетантки',
        content: `
          <div class="grid grid-cols-2" style="gap: 30px;">
            <div class="card" data-animate>
              <h3 style="font-size: 22px; margin-bottom: 16px;">О серии</h3>
              <p style="font-size: 16px; line-height: 1.6;">Серия детективных романов о приключениях Александры Покровской и её подруг. Каждая книга — это новое расследование, полное загадок и неожиданных поворотов.</p>
            </div>
            <div class="card" data-animate style="animation-delay: 0.1s">
              <h3 style="font-size: 22px; margin-bottom: 16px;">Главные персонажи</h3>
              <ul style="list-style: none; padding: 0;">
                <li style="margin-bottom: 12px; display: flex; align-items: center; gap: 12px;">
                  <span style="font-size: 20px;" aria-hidden="true">🕵️‍♀️</span>
                  <span>Александра Покровская - главная героиня</span>
                </li>
                <li style="margin-bottom: 12px; display: flex; align-items: center; gap: 12px;">
                  <span style="font-size: 20px;" aria-hidden="true">👩‍💼</span>
                  <span>Виктория - лучшая подруга</span>
                </li>
                <li style="display: flex; align-items: center; gap: 12px;">
                  <span style="font-size: 20px;" aria-hidden="true">🎩</span>
                  <span>Инспектор Грей - союзник</span>
                </li>
              </ul>
            </div>
          </div>
        `
      },
      {
        title: 'Долина Инферин',
        content: `
          <div class="card" data-animate>
            <h3 style="font-size: 22px; margin-bottom: 16px;">Мир Долины</h3>
            <p style="font-size: 16px; line-height: 1.6;">Фэнтезийный мир, полный магии и тайн. Здесь переплетаются судьбы героев и древние пророчества. Долина Инферин — это место, где каждый выбор может изменить судьбу всего мира.</p>
          </div>
        `
      }
    ];
    
    const section = sections[index] || { title: 'Скоро', content: '<p style="text-align: center; opacity: 0.6;">Информация скоро появится</p>' };
    
    content.innerHTML = `
      <h2 style="margin-bottom: 30px; animation: fadeInUp 0.4s ease;">${section.title}</h2>
      ${section.content}
    `;
    
    // Update active state
    document.querySelectorAll('.encyclopedia-nav .tag-pill').forEach((btn, i) => {
      const isActive = i === index;
      btn.classList.toggle('active', isActive);
      btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');
    });
    
    // Trigger animations
    setTimeout(() => checkVisibleElements(), 100);
    
  } catch (error) {
    console.error('Ошибка показа секции энциклопедии:', error);
    showError(content, 'Ошибка загрузки секции');
  }
}

// Service Worker registration for caching
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then((registration) => {
        console.log('SW registered: ', registration);
      })
      .catch((registrationError) => {
        console.log('SW registration failed: ', registrationError);
      });
  });
}

// Web Vitals monitoring (if available)
if (typeof getCLS !== 'undefined') {
  getCLS(console.log);
  getFID(console.log);
  getFCP(console.log);
  getLCP(console.log);
  getTTFB(console.log);
}

// Error tracking
window.addEventListener('error', (event) => {
  console.error('Global error:', event.error);
  // В продакшене отправлять в систему мониторинга
});

window.addEventListener('unhandledrejection', (event) => {
  console.error('Unhandled promise rejection:', event.reason);
  // В продакшене отправлять в систему мониторинга
});

console.log('🚀 Екатерина Новак - сайт загружен успешно!');
</script>
</body>
</html>
